<!DOCTYPE html>
<html lang="en">
<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PressureSole App</title>
    <!--<script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-p+..." crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style> 
        body {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            overflow-x: hidden; /* Prevents horizontal scrolling */
        }

        .navbar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: #bbb;
            padding: 10px 0;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;  /* Nav Bar will always appear on top */
        }

        .tab {
            text-align: center;
            color: black;
            padding: 10px;
            flex-grow: 1;
            cursor: pointer;
            font-weight: bold;
        }

        .tab:hover {
            background-color: #777;
        }

        .tab i {
            font-size: 24px;
            display: block;
            margin-bottom: 5px;
        }

        .content {
            display: none;
            text-align: center;
            margin-top: 120px;
            /*padding-top: 80px;*/
        }

        .active {
            display: block;
        }

        .resized-image {
            width: 300px;   /* Set the width of the image */
            height: auto;   /* Keep the aspect ratio intact */
            margin: 20px 0; /* Add top and bottom margins */
        }

        .logo-tab {
            padding: 0; /* Remove extra padding */
        }       

        .logo-image {
            height: 40px; /* Adjust size as needed */
            width: auto;
        }

        /* HOME Page Styling --------------------------------------------------------- */

        .container {
            display: flex;
            width: 100vw; /* Full width of the viewport */
            height: 100%; /* Adjust height to account for navbar */
            padding: 0; /* Remove default padding */
            margin: 0;  /* Remove default margin */
            box-sizing: border-box; /* Ensure padding does not affect width */
        }

        .left-half {
            width: 50%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center; 
            padding: 20px;
            box-sizing: border-box;
        }   

        .right-half {
            width: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center; /* This centers the content vertically */
            padding: 20px;
            box-sizing: border-box;
            background-color: white; /* White background for the right half */
            /*border: 1px solid red;*/
        }

        .left-half h1 {
            font-size: 42px;
            color: #000;
            margin-bottom: 0;
        }

        .left-half h2 {
            color: #333;
            margin-bottom: 0;
        }

        .left-half p {
            font-size: 18px;
            color: #555;
            margin-bottom: 0;
        }

        #home-profile-btn {
            background-color: grey;
            color: white;
            padding: 10px 20px;
            font-size: 18px;
            font-weight: bold;
            width: 50%;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .cta-button {
            background-color: red; /* Strava's signature orange #ff5500*/
            color: white;
            padding: 15px 25px;
            font-size: 18px;
            font-weight: bold;
            text-decoration: none;
            border-radius: 10px;
            display: inline-block;
            margin-top: 20px;
            border: none; /* Remove default button border */
        }

        /* Right Half - Run Stats */
        .stats-box {
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 10px;
        }

        .stats-box h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }

        .runstats-timestamp-header {
            text-align: center;
            font-size: 16px;
            color: #000;
            margin-bottom: 20px;
            width: 100%;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            color: #555;
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-item span {
            display: block;
            font-size: 24px;
            font-weight: bold;
            color: #222;
        }
            
        /* VISUALIZATIONS Page Styling -------------------------------------------------------- */

        /* Visualizations Tab Container */
        #visualizations {
            /*padding: 20px;*/
            background-color: white;
            font-family: Arial, sans-serif;
        }

        .visualization-main {
            padding: 20px;
        }

        .visualization-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin: 0 20px 10px 20px; /* Top: 0, Right: 20px, Bottom: 10px, Left: 20px */
            padding: 20px;
            width: calc(100% - 100px); /* Adjust width to account for left/right margins */
        }

        /* Header with the formatted timestamp */
        .visualization-header { /* FOR TIMESTAMP */
            text-align: left;
            font-size: 16px;
            color: #000;
            margin-bottom: 0px;
            width: 100%;
        }

        /* Flex container for the graphs */
        .graphs-container {
            display: flex;
        }

        /* Left group for symmetry (occupies 1 fraction) */
        .graph-group.symmetry {
            flex: 1;
            padding: 10px;
            text-align: center;
        }

        /* Right group for fatigue (occupies 3 fractions) */
        .graph-group.fatigue {
            flex: 3;
            padding: 10px;
            text-align: center;
        }

        /* Inside fatigue, show three images side by side */
        .fatigue-graphs {
            display: flex;
            justify-content: space-between;
        }

        .fatigue-graphs img {
            width: 32%;
            border-radius: 8px;
        }

        .graph-group.symmetry img {
            width: 100%;
            border-radius: 8px;
        }

        .period-headers-container {
            display: flex;
            justify-content: space-between;
            text-align: center;
            margin-bottom: 10px;
        }

        .period-header {
            flex: 1;
            font-size: 16px;
            font-weight: bold;
        }

        .fatigue-images-container {
            display: flex;
            justify-content: space-between;
        }

        .fatigue-images-container img {
            flex: 1;
            max-width: 32%;
            margin: 0 5px;
        }


        /* Toggle Button Styling */
        .view-toggle {
            text-align: center;
            margin-top: 0px;
            margin-bottom: 0px;
        }

        .view-toggle button {
            padding: 10px 20px;
            background-color: #eaeaea;
            color: #333;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        button:hover { /* Toggle button hover */
            background-color: #ccc;
        }

        /* Container for each view (section & gradient) */
        /*.visualization-box {
            margin: 0 30px 10px 30px; /* 20px left/right, 10px bottom */
            /*padding: 0px;
            background-color: white;
            border-radius: 8px;
        }

        /* Row layout for cards */
        /*.visualization-row {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }

        /* Card styling, similar to the score boxes */
        /*.visualization-card {
            flex: 1;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        /* Card header styling */
        .visualization-card-header {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid;
            color: #000;
            border-color: red;
        }

        /* Color coding for each card */
        #symmetry-section h2,
        #symmetry-gradient h2 {
            color: #2a9d8f;
            border-color: #2a9d8f;
        }

        #fatigue-section h2,
        #fatigue-gradient h2 {
            color: #e76f51;
            border-color: #e76f51;
        }

        /* Container for visualization content (images, etc.) */
        .visualization-content {
            text-align: center;
        }
        
        /* SCORES Page styling ------------------------------------------------------------- */
        .scoresContainerMain {              /* This is for the container surrounding ALL FOUR scores */
            display: flex;
            flex-direction: column; /* Stacks items vertically */
            align-items: center;
            /*width: 100%;*/
            margin-top: 20px;
        }

        /* Container that holds each set of scores (two rows: header on top, circles below) */
        .scoreBox {
            display: flex;
            flex-direction: column;
            width: calc(100% - 120px); /* Adjust width to account for left/right margins */
            margin: 0 20px 10px 20px; /* Top: 0, Right: 20px, Bottom: 10px, Left: 20px */
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        /* Header in the top row, left-justified */
        .score-header {
            text-align: left;
            font-size: 16px;
            color: #000;
            margin-bottom: 20px;
            width: 100%;
        }

        /* Your existing container for the circles */
        .scores-container {
            /*display: flex;
            justify-content: space-evenly;
            width: 100%;
            align-items: center;*/
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);  /* Create 4 equal-width columns */
            gap: 20px;       /* Adjust gap between score items as needed */
            width: 100%;
            box-sizing: border-box;
            padding: 0 20px; /* Optional: add side padding if desired */
        }

        .score-circle {
            position: relative;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: #eaeaea;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .score-circle .label {
            position: absolute;
            top: -25px; /* Position the label above the circle */
            font-size: 18px;
            font-weight: bold;
        }

        .score-circle .circle-content {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .score-circle .number {
            position: absolute;
            font-size: 36px;
            font-weight: bold;
            z-index: 2; /* Ensure number stays on top of the bar */
        }

        .score-circle svg .foreground {
            transform: rotate(0deg); /*-90deg*/
            transform-origin: 50% 50%;
        }

        /* General styling for the bars */
        .score-circle .bar {
            transition: stroke-dasharray 0.5s ease;
            transform: rotate(0deg); /* Start from the top */
        }


        /* Updated Stress, Symmetry, Fatigue Bar Color Styling */
        .score-circle.stress .bar {
            stroke-dasharray: 6, 440; /* Example calculation for 6% */
            stroke: green;
        }

        .score-circle.symmetry .bar {
            stroke-dasharray: 85, 440; /* Example calculation for 85% */
            stroke: green;
        }

        .score-circle.fatigue .bar {
            stroke-dasharray: 31, 440; /* Example calculation for 31% */
            stroke: green;
        }

        /* Ensure the correct colors and values are applied */
        .score-circle.stress[data-value="6"] .bar {
            stroke: green;
            stroke-dasharray: 26, 440;
        }

        .score-circle.symmetry[data-value="85"] .bar {
            stroke: green;
            stroke-dasharray: 374, 440;
        }

        .score-circle.fatigue[data-value="31"] .bar {
            stroke: green;
            stroke-dasharray: 136, 440;
        }

        /* Styling for the numbers in the center */
        .score-circle .number {
            font-size: 36px;
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Details Button styling */
        /* Container for each score item */
        .score-item {
            position: relative; /* So that absolutely positioned children (like .details-box) are relative to this container */
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;     /* Fills its grid cell */
            box-sizing: border-box;
            margin: 0;       /* Remove any extra margin since grid gap handles spacing */            
            
            /* position: relative; /* Makes it the reference for absolute positioning */
            /* display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px; */
        }

        /* Details Button styling (remains similar) */
        .details-btn {
            background-color: #eaeaea;
            color: #333;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        /* Hover state for the Details button */
        .details-btn:hover {
            background-color: #ccc;
        }

        /* Details Box styling - now absolutely positioned so it doesn't shift other elements */
        .details-box {
            position: relative;
            width: 90%;         /* Expand wider than the score item; adjust as needed */
            max-width: 500px;    /* Cap the width so it doesn't get too wide on a moderately large screen */
            background-color: #eaeaea;
            /*color: #333;
            border: 1px solid #ccc;*/
            /*padding: 10px;*/
            border-radius: 8px;
            font-size: 16px;
            display: none;       /* Hidden by default */
            z-index: 10;

            margin-top: 10px;
            background-color: #f9f9f9;
            padding: 15px;
            border-left: 5px solid;
            line-height: 1.5;
        }

        /* Details box 
        .details {
            margin-top: 15px;
            background-color: #f9f9f9;
            padding: 15px;
            border-left: 5px solid;
            border-radius: 6px;
            line-height: 1.5;
        }*/
        
        .details-placeholder {
            height: 0;
            transition: height 0.3s ease;
        }
        
        /* PROFILE Page styling -------------------------------------------------------------- */
        .profile-container {
            max-width: 1000px;
            margin: auto; /*50px*/
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        /* Form layout */
        
        .profile-form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    
        /* Form rows should have uniform padding and spacing */
        .form-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: calc(100% - 10px); /* Ensures row width is correct without breaking layout */
            padding: 0 0px; /* Uniform left and right padding for all rows */
            gap: 10px; /* Ensures spacing between form fields */
            margin-bottom: 15px; /* Space between rows */
            box-sizing: border-box; /* Ensures padding does not affect overall width */
        }

        /* Form groups (input containers) should distribute space equally */
        .form-group {
            flex: 1;
            min-width: 0; /* Prevents overflow */
        }

        /* Style for input fields */
        .profile-form input,
        .profile-form select {
            width: 100%;
            padding: 12px; /* Consistent padding inside input boxes */
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #eaeaea; /* Light grey background */
            font-size: 16px;
            color: #333;
            box-sizing: border-box; /* Ensures padding does not break width */
        }

        /* Labels */
        .profile-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        /* Save button */
        .profile-form button {
            width: calc(100% - 10px);
            padding: 10px;
            background-color: red; /* Strava's orange */
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
        }

        .profile-form button:hover {
            background-color: red;
        }
        
        input[type="password"]::-ms-reveal,
        input[type="password"]::-ms-clear {
            display: none;
        }
        
        input[type="password"]::-webkit-textfield-decoration-container {
            display: none;
        }
        
        input[type="password"]::-webkit-credentials-auto-fill-button {
            display: none !important;
        }
        
        /* FAQs Page styling -------------------------------------------------------------- */

        /* Container for the two FAQ columns */
        .faq-columns {
        display: flex;
        gap: 20px;
        justify-content: center;
        }

        /* Left and right column styles */
        .faq-column-left,
        .faq-column-right {
        display: flex;
        flex-direction: column;
        gap: 20px;
        flex: 1;
        }

        /* FAQ box styling */
        .faq-box {
        background-color: #f0f0f0;
        border-radius: 10px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        }

        /* FAQ question heading */
        .faq-box h3 {
        max-width: 90%;   
        margin: 0 auto;
        font-weight: bold;
        text-align: Left;
        }

        /* FAQ answer styling (hidden by default) */
        .faq-answer {
        margin-top: 10px;
        max-width: 90%; /* or any value you prefer */
        margin-left: auto;
        margin-right: auto; /* this centers the container within its parent */
        display: none;
        text-align: left;
        }
    </style>
</head>

<body>
    <!-- NAV BAR -------------------------------------------------------------------- -->
    <div class="navbar">
        <div class="tab logo-tab" onclick="showPage('home')">
            <img src="PressureSoleLogo_FullTransp.png" alt="PressureSole Logo" class="logo-image"/>
        </div>
        <div class="tab" onclick="showPage('visualizations')">
            <i class="fas fa-chart-line"></i>
            <span>Visualizations</span>
        </div>
        <div class="tab" onclick="showPage('gait-mechanics')">
            <i class="fas fa-running"></i>
            <span>Gait Mechanics</span>
        </div>
        <div class="tab" onclick="showPage('scores')">
            <i class="fas fa-star"></i>
            <span>Scores</span>
        </div>
        <div class="tab" onclick="showPage('profile')">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </div>
        <div class="tab" onclick="showPage('faqs')">
            <i class="fas fa-question-circle"></i>
            <span>FAQ's</span>
        </div>
    </div>
    
    <!-- Home tab -->
    <div id="home" class="content active">
        <div class="container">
            <!-- Left Half - Branding & Features -->
            <div class="left-half">
                <h1>Welcome to PressureSole</h1>
                <h2>Real-time Gait Tracking</h2>
                <p>Monitor your running mechanics with live feedback and optimize your performance.</p>
                <!-- I want the Sign Up / Log In button here -->
                <button id="home-profile-btn">Go to Profile</button>
            </div>
            <!-- Right Half - "Your Last Run" Stats -->
            <div class="right-half">
                <div class="stats-box">
                    <h2>Your Last Run</h2>
                    <!-- New element for the running icon and timestamp -->
                    <div id="home-timestamp" class="runstats-timestamp-header"></div>
                    <div class="stats">
                        <div class="stat-item" id="home-stress">
                            <span>0</span> Stress
                        </div>
                        <div class="stat-item" id="home-symmetry">
                            <span>0</span> Symmetry
                        </div>
                        <div class="stat-item" id="home-fatigue-left">
                            <span>0</span> Fatigue (Left)
                        </div>
                        <div class="stat-item" id="home-fatigue-right">
                            <span>0</span> Fatigue (Right)
                        </div>
                    </div>
                </div>
                <a href="#" class="cta-button" onclick="showPage('scores'); return false;">View Your Scores</a>
            </div>
        </div>
    </div>

    <!-- COMMENT OUT FOR NOW
    <div id="home" class="content active">
        <h1>Welcome to PressureSole</h1>
        <h2>Real-time Gait Tracking</h2>
        <p>See your latest run and feedback here.</p>
<<<<<<< HEAD
        <img src="PressureSoleLogo_Full.jpg" alt="logo full" class="resized-image"/>
=======
        <img src="srdesign2/srdesign/images/PressureSoleLogo_Full.jpg" alt="logo full" class="resized-image"/>
>>>>>>> a941849e38387b1ec1b5565716114cb65622b769
    </div>
    -->
    
<!-- VISUALIZAIONS tab ----------------------------------------------------------------------------->
    <div id="visualizations" class="content">
        <!-- Auth Prompt: Shown if the user is not logged in -->
        <div id="visualizations-auth" class="auth-prompt">
            <h1>Score Visualizations</h1>
            <button class="cta-button" onclick="showPage('profile')">Sign Up / Log In</button>
        </div>

        <!-- Main Content: Shown only when the user is logged in -->
        <div id="visualizations-content">
            <h1>Score Visualizations</h1>
            <div class="view-toggle">
                <button id="switch-view-btn" onclick="switchView()">Switch to Gradient View</button>
            </div>
            <!-- Section View Container -->
            <div id="section-view" class="visualization-main"></div>
            <!-- Gradient View Container -->
            <div id="gradient-view" class="visualization-main" style="display: none;"></div>
        </div>

        <!-- <h1>Score Visualizations</h1>
        <div class="view-toggle">
            <button id="switch-view-btn" onclick="switchView()">Switch to Gradient View</button>
        </div>-->
    
        <!-- Section View -->
        <!--<div id="section-view" class="visualization-box">
            <div class="visualization-row">-->
                <!-- Symmetry Card -->
                <!--<div id="symmetry-section" class="visualization-card">
                    <h2>Symmetry</h2>
                    <div id="symmetry-images" class="visualization-content">-->
                        <!-- Symmetry images will be inserted here -->
                    <!--</div>
                </div>-->
                <!-- Fatigue Card -->
                <!--<div id="fatigue-section" class="visualization-card">
                    <h2>Fatigue</h2>
                    <div id="fatigue-images" class="visualization-content">-->
                        <!-- Fatigue images will be inserted here -->
                    <!--</div>
                </div>
            </div>
        </div>-->
    
        <!-- Gradient View -->
        <!--<div id="gradient-view" class="visualization-box" style="display: none;">
            <div class="visualization-row">-->
                <!-- Symmetry Gradient Card -->
                <!--<div id="symmetry-gradient" class="visualization-card">
                    <h2>Symmetry</h2>
                    <div id="symmetry-gradient-images" class="visualization-content">-->
                        <!-- Symmetry gradient images will be inserted here -->
                    <!--</div>
                </div>-->
                <!-- Fatigue Gradient Card -->
                <!--<div id="fatigue-gradient" class="visualization-card">
                    <h2>Fatigue</h2>
                    <div id="fatigue-gradient-images" class="visualization-content">-->
                        <!-- Fatigue gradient images will be inserted here -->
                    <!--</div>
                </div>
            </div>
        </div>
    </div>-->

        <script>
        // Helper function to format a timestamp (14-digit string) into a human‑readable format.
        function formatTimestamp(timestampStr) {
            // Extract timestamp using the new regex format
            const timestampMatch = timestampStr.match(/(\d{4}-\d{2}-\d{2}_\d{2}-\d{2}-\d{2})/);
            if (!timestampMatch) {
                return "Invalid timestamp format";
            }
            // Split into date and time parts
            const [datePart, timePart] = timestampMatch[1].split('_');
            const [year, month, day] = datePart.split('-');
            const [hour, minute, second] = timePart.split('-');
            const date = new Date(year, month - 1, day, hour, minute, second);
            
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            const dateFormatted = date.toLocaleString('en-US', options);
            return `<i class="fas fa-running"></i> ${dateFormatted}`;
        }

        // Function to load and display visualizations for a given view (either 'section' or 'gradient')
        async function loadVisualizations(viewType) {
            const repoUrl = 'https://api.github.com/repos/PressureSole/srdesign/contents/images';
            try {
                const response = await fetch(repoUrl);
                if (!response.ok) {
                    console.error('Failed to fetch images.');
                    return;
                }
                const files = await response.json();
                // Filter files that contain the viewType (e.g., "section" or "gradient") and either "symmetry" or "fatigue"
                const filteredFiles = files.filter(file =>
                    file.name.includes(viewType) && (file.name.includes('symmetry') || file.name.includes('fatigue'))
                );

                // Group files by timestamp (assuming a 14-digit timestamp in the filename)
                const groups = {};
                filteredFiles.forEach(file => {
                    const match = file.name.match(/(\d{4}-\d{2}-\d{2}_\d{2}-\d{2}-\d{2})/);
                    if (match) {
                        const timestamp = match[1];
                        if (!groups[timestamp]) {
                            groups[timestamp] = [];
                        }
                        groups[timestamp].push(file);
                    }
                });
                // Sort timestamps in descending order so the most recent is first
                const sortedTimestamps = Object.keys(groups).sort((a, b) => b.localeCompare(a));

                // Select the proper container based on viewType
                const containerElement = document.getElementById(viewType + '-view'); // e.g. section-view or gradient-view
                containerElement.innerHTML = ''; // clear any existing content

                // Create a visualization container for each timestamp group
                sortedTimestamps.forEach(timestamp => {
                    const groupFiles = groups[timestamp];
                    // Find the symmetry image (assume one image per group)
                    const symmetryImage = groupFiles.find(file => file.name.includes('symmetry'));
                    // Get up to three fatigue images
                    const fatigueImages = groupFiles.filter(file => file.name.includes('fatigue')).slice(0, 3);

                    // Create the outer container
                    const visContainer = document.createElement('div');
                    visContainer.classList.add('visualization-container');

                    // Create header with formatted timestamp (similar to the scores header)
                    const headerDiv = document.createElement('div');
                    headerDiv.classList.add('visualization-header');
                    headerDiv.innerHTML = formatTimestamp(timestamp);
                    visContainer.appendChild(headerDiv);

                    // Create the container for graphs
                    const graphsDiv = document.createElement('div');
                    graphsDiv.classList.add('graphs-container');

                    // Create the symmetry group (left column)
                    const symmetryDiv = document.createElement('div');
                    symmetryDiv.classList.add('graph-group', 'symmetry');
                    const symmetryHeader = document.createElement('h2');
                    symmetryHeader.classList.add('visualization-card-header');
                    symmetryHeader.textContent = 'Symmetry';
                    symmetryDiv.appendChild(symmetryHeader);

                    // Insert empty placeholder headers for spacing (three empty elements)
                    const symmetryPlaceholderContainer = document.createElement('div');
                    symmetryPlaceholderContainer.classList.add('period-headers-container');
                    for (let i = 0; i < 3; i++) {
                        const emptyHeader = document.createElement('div');
                        emptyHeader.classList.add('period-header');
                        emptyHeader.innerHTML = '&nbsp;';  // Non-breaking space to preserve height
                        symmetryPlaceholderContainer.appendChild(emptyHeader);
                    }
                    symmetryDiv.appendChild(symmetryPlaceholderContainer);
                    
                    if (symmetryImage) {
                        const img = document.createElement('img');
                        img.src = `https://raw.githubusercontent.com/PressureSole/srdesign/main/${symmetryImage.path}`;
                        img.alt = symmetryImage.name;
                        symmetryDiv.appendChild(img);
                    } else {
                        symmetryDiv.innerHTML += '<p>No symmetry image</p>';
                    }

                    // Create the fatigue group (right three columns)
                    const fatigueDiv = document.createElement('div');
                    fatigueDiv.classList.add('graph-group', 'fatigue');
                    const fatigueHeader = document.createElement('h2');
                    fatigueHeader.classList.add('visualization-card-header');
                    fatigueHeader.textContent = 'Fatigue';
                    fatigueDiv.appendChild(fatigueHeader);

                    // New container for the three additional period headers beneath the Fatigue header
                    const periodHeadersContainer = document.createElement('div');
                    periodHeadersContainer.classList.add('period-headers-container');
                    const fatiguePeriodHeaders = ["1st Period", "2nd Period", "3rd Period"];
                    fatiguePeriodHeaders.forEach(text => {
                        const headerDiv = document.createElement('div');
                        headerDiv.classList.add('period-header');
                        headerDiv.textContent = text;
                        periodHeadersContainer.appendChild(headerDiv);
                    });
                    fatigueDiv.appendChild(periodHeadersContainer);

                    const fatigueGraphsDiv = document.createElement('div');
                    fatigueGraphsDiv.classList.add('fatigue-graphs');
                    if (fatigueImages.length > 0) {
                        fatigueImages.forEach(file => {
                            const img = document.createElement('img');
                            img.src = `https://raw.githubusercontent.com/PressureSole/srdesign/main/${file.path}`;
                            img.alt = file.name;
                            fatigueGraphsDiv.appendChild(img);
                        });
                    } else {
                        fatigueGraphsDiv.innerHTML = '<p>No fatigue images</p>';
                    }
                    fatigueDiv.appendChild(fatigueGraphsDiv);

                    // Append both graph groups to the graphs container
                    graphsDiv.appendChild(symmetryDiv);
                    graphsDiv.appendChild(fatigueDiv);
                    visContainer.appendChild(graphsDiv);

                    // Append the visualization container to the main container for the view
                    containerElement.appendChild(visContainer);
                });
            } catch (error) {
                console.error('Error fetching visualization images:', error);
            }
        }

        // Toggle between section and gradient views (update button text and reload visualizations)
        function switchView() {
            const sectionView = document.getElementById('section-view');
            const gradientView = document.getElementById('gradient-view');
            const button = document.getElementById('switch-view-btn');

            if (sectionView.style.display === "none") {
                sectionView.style.display = "block";
                gradientView.style.display = "none";
                button.innerHTML = "Switch to Gradient View";
                loadVisualizations('section');
            } else {
                sectionView.style.display = "none";
                gradientView.style.display = "block";
                button.innerHTML = "Switch to Section View";
                loadVisualizations('gradient');
            }
        }

        // When the page loads, default to the section view
        window.onload = function() {
            loadVisualizations('section');
        };
        </script>
    </div>



<!-- GAIT MECH tab ------------------------------------------------------------------- -->
    <div id="gait-mechanics" class="content">
        <!-- Auth Prompt -->
        <div id="gait-mechanics-auth" class="auth-prompt">
            <h1>Gait Mechanics</h1>
            <button class="cta-button" onclick="showPage('profile')">Sign Up / Log In</button>
        </div>    

        <div id="gait-mechanics-content">
            <h1>Gait Mechanics</h1>
            <!-- Container where run groups (each with cadence scale and pro/sup image) will be added -->
            <div id="run-groups-container"></div>
        </div>

        <!--<div id="gait-mechanics-content">
            <h1>Gait Mechanics</h1>

            <section id="cadence">
                <h2>Cadence</h2>
                <div class="graph-container" id="cadence-scales"></div>
                <div id="cadence-message" class="message-box"></div> 
            </section>

            <section id="supination-pronation">
                <h2>Supination/Pronation</h2>
                <button class="detail-toggle" onclick="toggleDetails('supination-details')">Details</button>
                <div id="supination-details" class="details" style="display:none;">
                    <p>If you see the center of pressure dot drift towards the inside of the foot, this is indicative of possible pronation. 
                    If you see the center of pressure dot drift towards the outside of the foot, this is indicative of possible supination.</p>

                    <p>Overpronation (excessive inward rolling) can lead to issues like plantar fasciitis, shin splints, and knee pain due to poor shock absorption and misalignment. Supination (or underpronation) is when the foot rolls outward, placing excessive stress on the outer edge of the foot and increasing the risk of ankle sprains, stress fractures, and IT band syndrome.</p>

                    <p>To address overpronation, runners can benefit from stability or motion-control shoes, along with strengthening the arch, hips, and glutes to improve alignment and control. For supination, using cushioned, neutral shoes and incorporating mobility work to increase ankle flexibility can help. Strengthening the calves, ankles, and intrinsic foot muscles can also promote better foot mechanics and reduce the risk of injury.</p>
                </div>

                <div class="graph-container" id="image-container">
                </div>
            </section>
        </div>-->
    </div>

<style>
    /* General styles */
    /* .gait-container {
        border: 1px solid #ccc;
        margin: 20px auto;
        padding: 15px;
        border-radius: 8px;
        max-width: 1000px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .gait-container-header {
        display: flex;
        align-items: center;
        font-size: 14px;
        margin-bottom: 10px;
    }

    .gait-container-header .run-icon {
        margin-right: 5px;
    }

    .gait-row {
        display: flex;
        justify-content: space-between;
    }

    .gait-left, .gait-right {
        flex: 1;
        margin: 0 10px;
    }

    .section-title {
        text-align: left;
        border-bottom: 2px solid red;
        padding-bottom: 5px;
        margin-bottom: 10px;
    }

    /* Graph container styles */
    /*.graph-container {
        width: 100%;
        min-height: 200px;
        background-color: #f9f9f9;
        margin: 15px 0;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 1px 5px rgba(0,0,0,0.05);
    }

    /* Cadence scales styling */
    #cadence-scales {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 30px;
    }
    
    .cadence-scale {
        text-align: center;
        background-color: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .cadence-scale h3 {
        margin-top: 0;
        margin-bottom: 15px;
        color: #555;
    }
    
    .cadence-scale canvas {
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    /* Message box styling */
    .message-box {
        margin-top: 20px;
        padding: 15px;
        border-radius: 6px;
        background-color: #f8f9fa;
        border-left: 4px solid #ccc;
        line-height: 1.5;
    }
    
    .message-box.green {
        border-left-color: #28a745;
        background-color: #e8f5e9;
    }
    
    .message-box.yellow {
        border-left-color: #ffc107;
        background-color: #fff8e1;
    }
    
    .message-box.red {
        border-left-color: #dc3545;
        background-color: #ffebee;
    }
    
    /* Detail toggle button */
    .detail-toggle {
        background-color: #eaeaea;
        color: #333;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 10px;
        font-size: 16px;
        transition: all 0.3s ease;
    }
    
    .detail-toggle:hover {
        background-color: #ccc;
    }

    /*.details-btn {
            background-color: #eaeaea;
            color: #333;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        ccc*/
    
    /* Gait Mech Details box */
    .details {
        margin-top: 10px;
        background-color: #f9f9f9;
        padding: 15px;
        border-left: 5px solid; /*#007BFF*/
        border-radius: 8px;
        line-height: 1.5;
    }
    
    .details p {
        margin: 0 0 15px 0;
    }
    
    .details p:last-child {
        margin-bottom: 0;
    }
    
    /* Image items */
    /*.image-item {
        margin-bottom: 30px;
        background-color: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .image-item .timestamp {
        color: #666;
        font-size: 14px;
        margin-bottom: 10px;
    }
    
    .image-item .image {
        max-width: 100%;
        border-radius: 6px;
        display: block;
        margin: 0 auto;
    }*/

    .run-group {
        /*border: 1px solid #ddd;*/
        background-color: white;
        border-radius: 8px;
        padding: 20px;
        margin: 0 40px 10px 40px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        width: calc(100% - 100px); /* Adjust width to account for left/right margins */
    }
    
    .run-group-header {
        font-size: 16px;
        margin-bottom: 0px;
        color: #000;
        text-align: left;
        width: 100%;
    }
    
    .run-group-content {
        display: flex;
        flex-wrap: nowrap;         /* Prevent the panels from wrapping to a new line */
        justify-content: space-between; /* Distribute any extra space evenly */
    }

        .run-group-content > div {
        width: calc(50% - 10px);    /* Each panel gets 50% minus half the gap */
        margin: 0;
        box-sizing: border-box;
    }
    
    .cadence-panel, .prosup-panel {
        flex: 1;
        min-width: 280px;
        background-color: white;
        padding: 15px;
        border-radius: 8px;
    }
    
    /* New header for each panel */
    .panel-header {
        text-align: center;
        /*font-size: 16px;*/
        color: black;
        border-bottom: 2px solid red;
        padding-bottom: 10px;
        margin-bottom: 10px;
    }
    
    .cadence-panel h3, .prosup-panel h3 {
        margin-top: 0;
        margin-bottom: 15px;
        color: #000;
        font-size: 18px;
        font-weight: bold;
    }
    
    .cadence-panel canvas {
        /*border: 1px solid #ddd;*/
        border-radius: 4px;
    }
    
    .prosup-panel img {
        max-width: 100%;
        border-radius: 6px;
        display: block;
        margin: 0 auto;
    }
</style>

<script>
    // --- Helper to extract the raw timestamp from filenames ---
    // For cadence files ("Run_Data_2025-03-27_07-15-31.txt") and
    // prosup files ("Run_Data_2025-03-27_07-15-31_cop_plot.png")
    function getRawTimestamp(fileName) {
        let ts = fileName;
        if(ts.startsWith("Run_Data_")) {
            ts = ts.substring("Run_Data_".length);
        }
        if(ts.endsWith("_cop_plot.png")) {
            ts = ts.substring(0, ts.length - "_cop_plot.png".length);
        } else if(ts.toLowerCase().endsWith(".txt")) {
            ts = ts.substring(0, ts.length - ".txt".length);
        }
        return ts; // e.g., "2025-03-27_07-15-31"
    }

    // --- Helper to format a raw timestamp (YYYY-MM-DD_HH-MM-SS) ---
    function formatRawTimestamp(rawTs) {
        const [datePart, timePart] = rawTs.split('_');
        const formattedTime = timePart.replace(/-/g, ':');
        const dateObj = new Date(datePart + ' ' + formattedTime);
        const options = {  // Define options here
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: true
        };
        return `<i class="fas fa-running"></i> ${dateObj.toLocaleString('en-US', options)}`;
    }

    /*function toggleDetails(detailsId, btn) {
        const details = document.getElementById(detailsId);
        if (details.style.display === "none" || details.style.display === "") {
            details.style.display = "block";
            btn.textContent = "Close";
        } else {
            details.style.display = "none";
            btn.textContent = "Details";
        }
    }*/

    // --- Helper to parse a raw timestamp into a Date object ---
    function parseRawTimestamp(rawTs) {
        const [datePart, timePart] = rawTs.split('_');
        const formattedTime = timePart.replace(/-/g, ':');
        return new Date(datePart + ' ' + formattedTime);
    }

    // --- Fetch cadence data ---
    // Returns an array of objects: { rawTimestamp, cadenceValues, fileName }
    async function fetchCadenceData() {
        const repoOwner = 'PressureSole';
        const repoName = 'srdesign';
        const folderPath = 'cadence';
        const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`;
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
            const files = await response.json();
            // Use a case-insensitive filter
            const txtFiles = files.filter(file => file.name.toLowerCase().endsWith('.txt'));
            const cadenceArray = [];
            for (let file of txtFiles) {
                console.log("Fetching cadence file from URL:", file.download_url); // Debug log
                try {
                    const content = await fetch(file.download_url, { mode: 'cors' }).then(r => r.text());
                    const values = content.split('\n')
                        .map(line => parseFloat(line.trim()))
                        .filter(val => !isNaN(val));
                    if (values.length > 0) {
                        cadenceArray.push({
                            rawTimestamp: getRawTimestamp(file.name),
                            cadenceValues: values,
                            fileName: file.name
                        });
                    }
                } catch (err) {
                    console.error(`Error processing ${file.name}:`, err);
                }
            }
            return cadenceArray;
        } catch (error) {
            console.error('Error fetching cadence data:', error);
            return [];
        }
    }

    // --- Fetch prosup image data ---
    // Returns an array of objects: { rawTimestamp, url, fileName }
    async function fetchProSupData() {
        const repoOwner = 'PressureSole';
        const repoName = 'srdesign';
        const folderPath = 'prosupvisual';
        const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`;
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
            const files = await response.json();
            // Use a case-insensitive filter for PNG files.
            const imageFiles = files.filter(file => file.name.toLowerCase().endsWith('.png'));
            const prosupArray = imageFiles.map(file => ({
                rawTimestamp: getRawTimestamp(file.name),
                url: file.download_url,
                fileName: file.name
            }));
            return prosupArray;
        } catch (error) {
            console.error('Error fetching prosup data:', error);
            return [];
        }
    }

    // New function to create a horizontal, non-linear cadence scale element.
    // New function to create a horizontal, non-linear cadence scale element.
    function createCadenceScaleElement(fileName, cadenceValues) {
        // New function to create a horizontal, non-linear cadence scale element.
        // Calculate average cadence for this file.
        const avgForFile = cadenceValues.reduce((sum, val) => sum + val, 0) / cadenceValues.length;
        
        // Determine the score color and details message based on the average cadence.
        let scoreColor, detailsMessage;
        if (avgForFile < 160) {
            scoreColor = "red";
            detailsMessage = "Low Red text";
        } else if (avgForFile >= 170 && avgForFile <= 180) {
            scoreColor = "green";
            detailsMessage = "Green text";
        } else if (avgForFile > 190) {
            scoreColor = "red";
            detailsMessage = "High Red text";
        } else {
            scoreColor = "yellow";
            detailsMessage = "Yellow text";
        }
        const cadScoreValue = avgForFile.toFixed(1);

        // Main container for the cadence panel (single column).
        const containerDiv = document.createElement('div');
        containerDiv.classList.add('cadence-panel');
        containerDiv.style.display = 'block'; // Single column layout.

        // Create the canvas.
        const canvas = document.createElement('canvas');
        canvas.style.width = "100%";
        // Define dimensions. The meter will span 90% of its container via CSS adjustments.
        // For this example, we're using a fixed width of 600px.
        const meterWidth = 600;            // Total width of the meter (in pixels)
        const meterHeight = 40;            // Height of the colored meter bar
        const triangleHeight = 15;         // Height allocated for the triangle indicator
        const totalCanvasHeight = meterHeight + triangleHeight + 10; // Extra space for ticks
        canvas.width = meterWidth;
        canvas.height = totalCanvasHeight;
        containerDiv.appendChild(canvas);

        const ctx = canvas.getContext('2d');

        // The meter is divided into 5 equal visual segments.
        const segmentVisualWidth = meterWidth / 5;

        // Use your gradient stops with smooth blending.
        const gradient = ctx.createLinearGradient(0, 0, meterWidth, 0);
        gradient.addColorStop(0, "red");
        gradient.addColorStop(0.10, "red");
        gradient.addColorStop(0.20, "yellow");
        gradient.addColorStop(0.37, "yellow");
        gradient.addColorStop(0.42, "green");
        gradient.addColorStop(0.58, "green");
        gradient.addColorStop(0.63, "yellow");
        gradient.addColorStop(0.80, "yellow");
        gradient.addColorStop(0.90, "red");
        gradient.addColorStop(1, "red");

        // Draw the horizontal meter.
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, meterWidth, meterHeight);
        // Draw a border around the meter.
        ctx.strokeStyle = "#ddd";
        ctx.lineWidth = 1;
        ctx.strokeRect(0, 0, meterWidth, meterHeight);

        // Function for non-linear mapping of a cadence value to an x-position.
        function mapCadenceToX(value) {
            // Clamp the value between 0 and 380.
            value = Math.min(Math.max(value, 0), 380);
            if (value <= 160) {
                return (value / 160) * segmentVisualWidth;
            } else if (value <= 170) {
                return segmentVisualWidth + ((value - 160) / 10) * segmentVisualWidth;
            } else if (value <= 180) {
                return 2 * segmentVisualWidth + ((value - 170) / 10) * segmentVisualWidth;
            } else if (value <= 190) {
                return 3 * segmentVisualWidth + ((value - 180) / 10) * segmentVisualWidth;
            } else {
                return 4 * segmentVisualWidth + ((value - 190) / 190) * segmentVisualWidth;
            }
        }

        // Draw scale markers (ticks) and their values (in light grey) at: 160, 170, 180, 190.
        const markerValues = [160, 170, 180, 190];
        ctx.fillStyle = "#333"; // Light grey for markers and text. aaa
        ctx.strokeStyle = "#333";
        ctx.lineWidth = 1;
        markerValues.forEach(val => {
            const x = mapCadenceToX(val);
            // Draw a tick mark at the bottom edge of the meter.
            ctx.beginPath();
            ctx.moveTo(x, meterHeight);
            ctx.lineTo(x, meterHeight + 5);
            ctx.stroke();
            // Draw the value text below the tick.
            ctx.font = "12px Arial";
            ctx.textAlign = "center";
            ctx.fillText(val.toString(), x, meterHeight + 18);
        });

        // Draw the average cadence indicator as a triangle beneath the meter.
        const avgX = mapCadenceToX(avgForFile);
        const triangleWidth = 12; // Width of the triangle's base.
        const triangleTipY = meterHeight; // Tip touches the bottom of the meter.
        const triangleBaseY = meterHeight + triangleHeight; // Base of the triangle.
        ctx.fillStyle = "#000"; // Color for the triangle.
        ctx.beginPath();
        ctx.moveTo(avgX, triangleTipY); // Tip of the triangle.
        ctx.lineTo(avgX - triangleWidth / 2, triangleBaseY);
        ctx.lineTo(avgX + triangleWidth / 2, triangleBaseY);
        ctx.closePath();
        ctx.fill();

        // Create a container for the header and details button.
        const textContainer = document.createElement('div');
        textContainer.style.textAlign = 'center';
        textContainer.style.marginTop = '10px';

        // Create header displaying the actual cadence score value with color styling.
        const cadScoreHeader = document.createElement('h3');
        cadScoreHeader.innerHTML = "Your Cadence: <span style='color:" + scoreColor + "; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);'>" + cadScoreValue + "</span>";
        cadScoreHeader.style.marginBottom = '5px';
        textContainer.appendChild(cadScoreHeader);

        // Create the "Details" button (assuming similar formatting as the scores page).
        const detailsButton = document.createElement('button');
        detailsButton.textContent = "Details";
        detailsButton.classList.add("detail-toggle");
        textContainer.appendChild(detailsButton);

        // Create a container for the details text, initially hidden.
        const detailsContainer = document.createElement('div');
        detailsContainer.classList.add("details");
        detailsContainer.style.display = "none";
        detailsContainer.style.textAlign = "left";
        detailsContainer.style.margin = "10px auto 0 auto";
        detailsContainer.style.width = "75%";

        // Set the side border color to match the score color.
        detailsContainer.style.borderLeft = "5px solid " + scoreColor;
        detailsContainer.style.paddingLeft = "10px";
        detailsContainer.textContent = detailsMessage;
        textContainer.appendChild(detailsContainer);

        detailsContainer.textContent = detailsMessage;
        textContainer.appendChild(detailsContainer);

        // Add click event listener to toggle the details container and update button text.
        detailsButton.addEventListener('click', function(){
            if (detailsContainer.style.display === "none" || detailsContainer.style.display === "") {
                detailsContainer.style.display = "block";
                detailsButton.textContent = "Close";
            } else {
                detailsContainer.style.display = "none";
                detailsButton.textContent = "Details";
            }
        });

        containerDiv.appendChild(textContainer);

        return containerDiv;
    }

    // --- Function to create a prosup image element ---
    function createProSupElement(prosupData) {
        // Main container for the prosup panel split into two columns.
        const containerDiv = document.createElement('div');
        containerDiv.classList.add('prosup-panel');
        containerDiv.style.display = 'flex';
        containerDiv.style.gap = '20px';

        // LEFT COLUMN: ProSup Image (remains unchanged)
        const leftCol = document.createElement('div');
        leftCol.style.flex = '1';

        const img = document.createElement('img');
        img.src = prosupData.url;
        img.alt = "Foot pressure analysis from " + formatRawTimestamp(prosupData.rawTimestamp);
        img.onerror = function() {
            img.alt = "Image failed to load";
            img.style.height = "150px";
            img.style.backgroundColor = "#f8f9fa";
            img.style.border = "1px dashed #ccc";
        };
        leftCol.appendChild(img);

        // RIGHT COLUMN: Split into two vertical containers for Pronation and Supination.
        const rightCol = document.createElement('div');
        rightCol.style.flex = '1';
        rightCol.style.display = 'flex';
        rightCol.style.flexDirection = 'column';
        // Use a vertical gap between the two containers.
        rightCol.style.gap = '20px';

        // --- Top Container: Pronation ---
        const pronationContainer = document.createElement('div');
        pronationContainer.style.height = "50%";
        pronationContainer.style.display = 'flex';
        pronationContainer.style.flexDirection = 'column';
        pronationContainer.style.alignItems = 'center';
        
        // Header for Pronation
        const pronationHeader = document.createElement('h3');
        pronationHeader.textContent = "Pronation: Excessive inner foot loading";
        pronationHeader.style.marginBottom = "5px";
        pronationContainer.appendChild(pronationHeader);
        
        // Pronation button
        const pronationBtn = document.createElement('button');
        pronationBtn.classList.add("detail-toggle");
        pronationBtn.textContent = "Pronation";
        pronationContainer.appendChild(pronationBtn);
        
        // Pronation details container
        const pronationDetails = document.createElement('div');
        pronationDetails.classList.add("details");
        pronationDetails.style.display = "none";
        pronationDetails.style.textAlign = "left";
        pronationDetails.style.marginTop = "10px";
        pronationDetails.style.borderLeft = "5px solid black";
        pronationDetails.style.paddingLeft = "10px";
        pronationDetails.textContent = "Pro text";
        pronationContainer.appendChild(pronationDetails);
        
        // Toggle functionality for pronation button
        pronationBtn.addEventListener('click', function() {
            if (pronationDetails.style.display === "none" || pronationDetails.style.display === "") {
                pronationDetails.style.display = "block";
                pronationBtn.textContent = "Close";
            } else {
                pronationDetails.style.display = "none";
                pronationBtn.textContent = "Pronation";
            }
        });

        // --- Bottom Container: Supination ---
        const supinationContainer = document.createElement('div');
        supinationContainer.style.height = "50%";
        supinationContainer.style.display = 'flex';
        supinationContainer.style.flexDirection = 'column';
        supinationContainer.style.alignItems = 'center';
        
        // Header for Supination
        const supinationHeader = document.createElement('h3');
        supinationHeader.textContent = "Supination: Excessive outer foot loading";
        supinationHeader.style.marginBottom = "5px";
        supinationContainer.appendChild(supinationHeader);
        
        // Supination button
        const supinationBtn = document.createElement('button');
        supinationBtn.classList.add("detail-toggle");
        supinationBtn.textContent = "Supination";
        supinationContainer.appendChild(supinationBtn);
        
        // Supination details container
        const supinationDetails = document.createElement('div');
        supinationDetails.classList.add("details");
        supinationDetails.style.display = "none";
        supinationDetails.style.textAlign = "left";
        supinationDetails.style.marginTop = "10px";
        supinationDetails.style.borderLeft = "5px solid black";
        supinationDetails.style.paddingLeft = "10px";
        supinationDetails.textContent = "Sup text";
        supinationContainer.appendChild(supinationDetails);
        
        // Toggle functionality for supination button
        supinationBtn.addEventListener('click', function() {
            if (supinationDetails.style.display === "none" || supinationDetails.style.display === "") {
                supinationDetails.style.display = "block";
                supinationBtn.textContent = "Close";
            } else {
                supinationDetails.style.display = "none";
                supinationBtn.textContent = "Supination";
            }
        });
        
        // Append the two containers into the right column.
        rightCol.appendChild(pronationContainer);
        rightCol.appendChild(supinationContainer);

        // Append left and right columns to the main container.
        containerDiv.appendChild(leftCol);
        containerDiv.appendChild(rightCol);

        return containerDiv;
    }


    // --- Main function to load and group runs by timestamp ---
    async function loadGaitMechanicsRuns() {
        // Fetch cadence and prosup data in parallel.
        const [cadenceData, prosupData] = await Promise.all([fetchCadenceData(), fetchProSupData()]);
        // Group by raw timestamp.
        const runsByTimestamp = {};
        // Always add cadence data, even if prosup is missing.
        cadenceData.forEach(item => {
            const ts = item.rawTimestamp;
            if (!runsByTimestamp[ts]) runsByTimestamp[ts] = { cadence: null, prosup: null };
            runsByTimestamp[ts].cadence = item;
        });
        // Add prosup data.
        prosupData.forEach(item => {
            const ts = item.rawTimestamp;
            if (!runsByTimestamp[ts]) runsByTimestamp[ts] = { cadence: null, prosup: null };
            runsByTimestamp[ts].prosup = item;
        });
        // Convert groups to an array and sort by timestamp (newest first).
        const runGroups = Object.keys(runsByTimestamp).map(ts => ({
            rawTimestamp: ts,
            ...runsByTimestamp[ts]
        }));
        runGroups.sort((a, b) => parseRawTimestamp(b.rawTimestamp) - parseRawTimestamp(a.rawTimestamp));
        // Get container.
        const container = document.getElementById('run-groups-container');
        container.innerHTML = '';
        // For each run group, create a flex container with header and two panels.
        runGroups.forEach(group => {
            const groupDiv = document.createElement('div');
            groupDiv.classList.add('run-group');
            // Header with formatted timestamp.
            const header = document.createElement('div');
            header.classList.add('run-group-header');
            header.innerHTML = formatRawTimestamp(group.rawTimestamp);
            groupDiv.appendChild(header);
            // Content container (flex)
            const contentDiv = document.createElement('div');
            contentDiv.classList.add('run-group-content');

            // LEFT PANEL: Cadence with header
            const leftDiv = document.createElement('div');
            leftDiv.style.flex = '1 1 50%';
            leftDiv.style.margin = '0 10px';
            
            // Create and append the header for Cadence.
            const cadenceHeader = document.createElement('h2');
            cadenceHeader.classList.add('panel-header');
            cadenceHeader.textContent = "Cadence";
            leftDiv.appendChild(cadenceHeader);
            
            // Append cadence panel or placeholder.
            if (group.cadence) {
                const cadenceEl = createCadenceScaleElement(group.cadence.fileName, group.cadence.cadenceValues);
                leftDiv.appendChild(cadenceEl);
            } else {
                const placeholder = document.createElement('div');
                placeholder.classList.add('cadence-panel');
                placeholder.textContent = "No cadence data available.";
                leftDiv.appendChild(placeholder);
            }
            contentDiv.appendChild(leftDiv);

            // RIGHT PANEL: Pronation / Supination with header
            const rightDiv = document.createElement('div');
            rightDiv.style.flex = '1 1 50%';
            rightDiv.style.margin = '0 10px';

            // Create and append the header for Pronation / Supination.
            const prosupHeader = document.createElement('h2');
            prosupHeader.classList.add('panel-header');
            prosupHeader.textContent = "Pronation / Supination";
            rightDiv.appendChild(prosupHeader);            

            // Append prosup panel or placeholder.
            if (group.prosup) {
                const prosupEl = createProSupElement(group.prosup);
                rightDiv.appendChild(prosupEl);
            } else {
                const placeholder = document.createElement('div');
                placeholder.classList.add('prosup-panel');
                placeholder.textContent = "No supination/pronation image available.";
                rightDiv.appendChild(placeholder);
            }
            contentDiv.appendChild(rightDiv);

            // Append content container to the group.
            groupDiv.appendChild(contentDiv);
            container.appendChild(groupDiv);
        });
    }

    // Initialize on DOMContentLoaded.
    document.addEventListener('DOMContentLoaded', function() {
        loadGaitMechanicsRuns();
    });
</script>

    <!-- SCORES tab ------------------------------------------------------------- -->
    <div id="scores" class="content">
        <!-- Auth Prompt -->
        <div id="scores-auth" class="auth-prompt">
            <h1>Scores</h1>
            <button class="cta-button" onclick="showPage('profile')">Sign Up / Log In</button>
        </div>

        <!--    Total_Stress = min(((R_Stress + L_Stress) / 2), 100)  -->

        <div id="scores-content">
            <h1>Scores</h1>
            <div id="scoresContainer" class="scoresContainerMain"></div>
            <div class="scores-container">
                <!-- Stress Score -->
                <!--<div class="score-item">
                    <div class="score-circle stress" data-color="green"> 
                        <div class="label">Stress</div>
                        <div class="circle-content">
                            <svg width="200" height="200" viewBox="0 0 100 100">-->
                                <!-- Background Circle -->
                                <!--<circle cx="50" cy="50" r="40" fill="none" stroke="#ddd" stroke-width="10" />-->
                                
                                <!-- Wrap the foreground circle in a group with an inline transform -->
                                <!--<g transform="rotate(-90,50,50)">
                                    <circle class="foreground" cx="50" cy="50" r="40" fill="none" stroke="green" stroke-width="10"
                                        stroke-dasharray="251.2" stroke-dashoffset="251.2" stroke-linecap="round" />
                                </g>
                            </svg>
                            <div class="number">0</div>-->
                            <!-- <div class="number">6</div> -->
                        <!--</div>
                    </div>-->
                    <!-- Details button and box -->
                    <!--<button class="details-btn">Details</button>
                    <div class="details-box"></div>
                </div>-->

                <!-- Symmetry Score -->
                <!--<div class="score-item">
                    <div class="score-circle symmetry" data-color="green"> 
                        <div class="label">Symmetry</div>
                        <div class="circle-content">
                            <svg width="200" height="200" viewBox="0 0 100 100">-->
                                <!-- Background Circle -->
                                <!--<circle cx="50" cy="50" r="40" fill="none" stroke="#ddd" stroke-width="10" />-->
                                
                                <!-- Wrap the foreground circle in a group with an inline transform -->
                                <!--<g transform="rotate(-90,50,50)">
                                    <circle class="foreground" cx="50" cy="50" r="40" fill="none" stroke="green" stroke-width="10"
                                        stroke-dasharray="251.2" stroke-dashoffset="251.2" stroke-linecap="round" />
                                </g>
                            </svg>
                            <div class="number">0</div>
                        </div>
                    </div>-->
                    <!-- Details button and box -->
                    <!--<button class="details-btn">Details</button>
                    <div class="details-box"></div>
                </div>-->

                <!-- Fatigue (Left) Score -->
                <!--<div class="score-item">
                    <div class="score-circle fatigue-left" data-color="green">
                        <div class="label">Fatigue (Left)</div>
                        <div class="circle-content">
                            <svg width="200" height="200" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="40" fill="none" stroke="#ddd" stroke-width="10" />
                                <g transform="rotate(-90,50,50)">
                                    <circle class="foreground" cx="50" cy="50" r="40" fill="none" stroke="green" stroke-width="10"
                                            stroke-dasharray="251.2" stroke-dashoffset="251.2" stroke-linecap="round" />
                                </g>
                            </svg>
                            <div class="number">0</div>
                        </div>
                    </div>
                    <button class="details-btn">Details</button>
                    <div class="details-box"></div>
                </div>-->
                
                <!-- Fatigue (Right) Score -->
                <!--<div class="score-item">
                    <div class="score-circle fatigue-right" data-color="green">
                        <div class="label">Fatigue (Right)</div>
                        <div class="circle-content">
                            <svg width="200" height="200" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="40" fill="none" stroke="#ddd" stroke-width="10" />
                                <g transform="rotate(-90,50,50)">
                                    <circle class="foreground" cx="50" cy="50" r="40" fill="none" stroke="green" stroke-width="10"
                                            stroke-dasharray="251.2" stroke-dashoffset="251.2" stroke-linecap="round" />
                                </g>
                            </svg>
                            <div class="number">0</div>
                        </div>
                    </div>
                    <button class="details-btn">Details</button>
                    <div class="details-box"></div>
                </div> -->
            </div>
        </div>
    </div>

    <!-- Profile tab -->
    <!-- <div id="profile" class="content">    
        <div class="profile-container">
            <h1>Profile</h1>
            <p>Manage your user profile and personal information.</p>
            <form id="profile-form" class="profile-form"> -->
                <!-- New Username Field -->
                <!-- <div class="form-row">
                    <div class="form-group">
                        <label for="username">Username:</label>
                        <input type="text" id="username" name="username">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="first-name">First Name:</label>
                        <input type="text" id="first-name" name="firstName">
                    </div>
                    <div class="form-group">
                        <label for="last-name">Last Name:</label>
                        <input type="text" id="last-name" name="lastName">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="weight">Weight (lbs):</label>
                        <input type="number" id="weight" name="weight">
                    </div>
                    <div class="form-group">
                        <label for="gender">Gender:</label>
                        <select id="gender" name="gender">
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <button type="submit">Save Profile</button>
            </form> -->

            <!-- Temporary measure to view all saved profiles -->
            <!-- <button id="show-profiles-btn" onclick="showProfiles()">Show All Profiles</button>
            <button id="clear-profiles-btn" onclick="clearProfiles()">Clear Profiles</button>
            <div id="profiles-output" style="margin-top:20px; background:#f7f7f7; padding:10px; border:1px solid #ccc;"></div>
            
        </div>
    </div> -->

    <!-- Profile tab NEW -------------------------------------------------------- -->
    <div id="profile" class="content">
        <!-- Sign Up and Log In Container -->
        <div id="signup-login-container" style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
            <!-- Sign Up Box -->
            <div class="signup-box" style="flex: 1; max-width: 500px; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
                <h1>Sign Up</h1>
                <form id="signup-form" class="profile-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="signup-username">Username:</label>
                            <input type="text" id="signup-username" name="username">
                        </div>
                    </div>
                    <div class="form-row" style="position: relative;">
                        <div class="form-group" style="width: 100%;">
                          <label for="signup-password">Password:</label>
                          <input type="password" id="signup-password" name="password">
                          <!-- Eye icon for toggling password visibility in Sign Up form -->
                          <i id="signup-toggle-password" class="fas fa-eye" style="position: absolute; top: 35px; right: 10px; cursor: pointer;"></i>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="first-name">First Name:</label>
                            <input type="text" id="first-name" name="firstName">
                        </div>
                        <div class="form-group">
                            <label for="last-name">Last Name:</label>
                            <input type="text" id="last-name" name="lastName">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="weight">Weight (lbs):</label>
                            <input type="number" id="weight" name="weight">
                        </div>
                    </div>
                    <button type="submit">Sign up</button>
                </form>
            </div>
            
            <!-- Log In Box -->
            <div class="login-box" style="flex: 1; max-width: 500px; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
                <h1>Log In</h1>
                <form id="login-form" class="profile-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="login-username">Username:</label>
                            <input type="text" id="login-username" name="username">
                        </div>
                    </div>
                    <div class="form-row" style="position: relative;">
                        <div class="form-group" style="width: 100%;">
                          <label for="login-password">Password:</label>
                          <input type="password" id="login-password" name="password">
                          <!-- Eye icon for toggling password visibility in Log In form -->
                          <i id="login-toggle-password" class="fas fa-eye" style="position: absolute; top: 35px; right: 10px; cursor: pointer;"></i>
                        </div>
                    </div>
                    <button type="submit">Log In</button>
                </form>
            </div>
        </div>
        
        <!-- Your Profile container -->
        <div id="your-profile" class="profile-container" style="max-width: 500px; margin: auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); display: none;">
            <h1>Your Profile</h1>
            <form id="profile-view-form" class="profile-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="display-username">Username:</label>
                        <input type="text" id="display-username" name="username" readonly style="background-color: #eaeaea;">
                    </div>
                </div>
                <div class="form-row" style="position: relative;">
                    <div class="form-group" style="width: 100%;">
                      <label for="display-password">Password:</label>
                      <input type="password" id="display-password" name="password" readonly style="background-color: #eaeaea; padding-right: 40px;">
                      <!-- Eye icon for toggling password visibility in the Your Profile form -->
                      <i id="profile-toggle-password" class="fas fa-eye" style="position: absolute; top: 35px; right: 10px; cursor: pointer; display: none;"></i>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="display-first-name">First Name:</label>
                        <input type="text" id="display-first-name" name="firstName" readonly style="background-color: #eaeaea;">
                    </div>
                    <div class="form-group">
                        <label for="display-last-name">Last Name:</label>
                        <input type="text" id="display-last-name" name="lastName" readonly style="background-color: #eaeaea;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="display-weight">Weight (lbs):</label>
                        <input type="number" id="display-weight" name="weight" readonly style="background-color: #eaeaea;">
                    </div>
                </div>
                <button type="button" id="edit-profile-btn" style="width: calc(100% - 10px); padding: 10px; background-color: #ff5500; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; margin-top: 20px;">Edit Profile</button>
            </form>

            <!-- New Log Out button -->
            <button type="button" id="logout-btn" style="width: 150px; padding: 10px; background-color: grey; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; margin-top: 20px;">Log Out</button>
            
            <!-- Show Profiles and Clear Profiles Buttons -->
            <div style="margin-top: 20px; text-align: center;">
                <button id="show-profiles-btn" onclick="showProfiles()" style="padding: 10px 20px; background-color: #2a9d8f; color: white; border: none; border-radius: 5px; cursor: pointer;">Show All Profiles</button>
                <button id="clear-profiles-btn" onclick="clearProfiles()" style="padding: 10px 20px; background-color: #e76f51; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">Clear Profiles</button>
            </div>
            <div id="profiles-output" style="margin-top: 20px; background: #f7f7f7; padding: 10px; border: 1px solid #ccc;"></div>
        </div>

        <!-- Run History container -->
        <!-- <div class="run-history-container" style="display: none; max-width: 1000px; margin: 20px auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
            <h1 style="text-align: center; margin-bottom: 20px;">Run History</h1>
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background-color: #f4f4f4;">
                  <th style="padding: 10px; text-align: left;">Date</th>
                  <th style="padding: 10px; text-align: left;">Distance</th>
                  <th style="padding: 10px; text-align: left;">Stress</th>
                  <th style="padding: 10px; text-align: left;">Symmetry</th>
                  <th style="padding: 10px; text-align: left;">Fatigue</th>
                </tr>
              </thead>
              <tbody>-->
                <!-- For now, there is only one run row -->
                <!--<tr>
                  <td style="padding: 10px;">--</td>
                  <td style="padding: 10px;">--</td>
                  <td id="run-stress" style="padding: 10px;">--</td>
                  <td id="run-symmetry" style="padding: 10px;">--</td>
                  <td id="run-fatigue" style="padding: 10px;">--</td>
                </tr>
              </tbody>
            </table>
        </div>-->
    </div>

    <!-- FAQs tab --------------------------------------------------------------------- -->
    <div id="faqs" class="content">
        <h1>Frequently Asked Questions</h1>
        <div class="faqs-container" style="padding: 20px;">
            <!-- <h1 style="text-align: center; margin-bottom: 20px;">Frequently Asked Questions</h1> -->
            <div class="faq-columns">
                <div class="faq-column-left">
                    <div class="faq-box">
                        <h3>What is PressureSole and how does it help runners?</h3>
                        <div class="faq-answer">PressureSole is a low-cost insole with embedded sensors that provides feedback on your running form. It helps reduce the risk of running-related injuries by giving real-time insights into stress, fatigue, and symmetry during your runs.</div>
                    </div>
                    <div class="faq-box">
                        <h3>How does PressureSole calculate my Stress, Fatigue, and Symmetry scores?</h3>
                        <div class="faq-answer">The system analyzes pressure values collected from 11 sensors placed across the insole and PressureSole’s models process this data to provide:<br>
                            Stress: Overall loading and intensity on your feet.<br>
                            Fatigue: Signs of declining performance (force output, step rate, contact time).<br>
                            Symmetry: The balance between your left and right foot pressures. </div>
                    </div>
                    <div class="faq-box">
                        <h3>Why did you choose to use 11 sensors instead of more?</h3>
                        <div class="faq-answer">Through extensive research, we found that 11 strategically placed sensors provide a strong balance between accuracy and cost reduction. This keeps the product affordable without sacrificing meaningful data.</div>
                    </div>
                </div>
                <div class="faq-column-right">
                    <div class="faq-box">
                        <h3>How accurate is PressureSole compared to professional devices?</h3>
                        <div class="faq-answer">PressureSole achieves approximately 80% accuracy when compared to industry-standard devices like the Loadsol, which is sufficient for amateur runners to receive actionable feedback at a much lower cost.</div>
                    </div>
                    <div class="faq-box">
                        <h3>Is PressureSole only for runners or can others use it? </h3>
                        <div class="faq-answer">While the primary focus is on amateur runners, PressureSole can be useful for anyone looking to recieve feedback on their risk for injury, including athletes in other sports or individuals undergoing physical therapy.</div>
                    </div>
                    <div class="faq-box">
                        <h3>How is data transmitted from the insole to the web app? </h3>
                        <div class="faq-answer">Pressure data is collected via the embedded sensors and transmitted wirelessly to the web app through a Bluetooth-enabled PCB, where it is processed and displayed in real time.</div>
                    </div>
                    <div class="faq-box">
                        <h3>What do "first period", "second period", and "third period" refer to under "fatigue" on the visualizations page? </h3>
                        <div class="faq-answer">The purpose of the fatique visualization is to display the changes in forcing throughout a run. "First period" refers to the distribution of forcing for the first third of the run (33%). "Second period" refers to the distrubiton of forcing for the second third of the runn (33%-66%) and so on.</div>
                    </div>
                    <div class="faq-box">
                        <h3>How do I interpret the pronation/supination visualization in the Gait Mechanics tab?</h3>
                        <div class="faq-answer">If you see the center of pressure dot drift towards the inside of the foot, this is indicative of possible pronation. 
                            If you see the center of pressure dot drift towards the outside of the foot, this is indicative of possible supination.
                            overpronation (excessive inward rolling) can lead to issues like plantar fasciitis, shin splints, and knee pain due to poor shock absorption and misalignment. 
                            Supination (or underpronation) is when the foot rolls outward, placing excessive stress on the outer edge of the foot and increasing the risk of ankle sprains, stress fractures, and IT band syndrome. 
                            To address overpronation, runners can benefit from stability or motion-control shoes, along with strengthening the arch, hips, and glutes to improve alignment and control. 
                            For supination, using cushioned, neutral shoes and incorporating mobility work to increase ankle flexibility can help. Strengthening the calves, ankles, and intrinsic foot muscles can also promote better foot mechanics and reduce the risk of injury.</div>
                    </div>
            </div>
        </div>
    </div>

    <!-- SCRIPT / FUNCTIONS ----------------------------------------------------------------- -->
    <script>
        // Nav Bar Tab 
        function showPage(pageId) {
            console.log("Switching to page: " + pageId);  // Debugging log
            // Hide all pages
            var pages = document.querySelectorAll('.content');
            pages.forEach(page => page.classList.remove('active'));
            
            // Show the selected page
            var pageToShow = document.getElementById(pageId);
            if (pageToShow) {
                pageToShow.classList.add('active');

                // If this is one of the pages that depend on authentication, check auth.
                if (['visualizations', 'gait-mechanics', 'scores'].includes(pageId)) { // add back 'gait-mechanics'
                    checkAuth(pageId);
                }
                // If the home page is being shown, update the home button
                if (pageId === 'home') {
                    updateHomeProfileButton();
                }
            } else {
                console.error("No page found with id:", pageId);
            }
        }

        // Check AUTH (User must be logged in) -------------------------------------------------------
        function checkAuth(pageId) {
            if (['visualizations', 'gait-mechanics', 'scores'].includes(pageId)) {
                const isLoggedIn = localStorage.getItem('currentUser');
                const authDiv = document.getElementById(pageId + '-auth');
                const contentDiv = document.getElementById(pageId + '-content');
                
                if (!isLoggedIn) {
                    authDiv.style.display = 'block';
                    contentDiv.style.display = 'none';
                } else {
                    authDiv.style.display = 'none';
                    contentDiv.style.display = 'block';
                }
            }
        }

        // Auto Score Load -----------------------------------------------------------------

        // Global variable to hold the raw scores loaded from file
        let rawScores = {
            R_Stress: 0,
            L_Stress: 0,
            Symmetry_Score: 0,
            Right_Fatigue: 0,
            Left_Fatigue: 0
        };

        // Helper: Convert a timestamp string ("YYYY-MM-DD_HH-MM-SS") to a formatted header string.
        let latestTimestamp = ''; // Global variable to hold the latest timestamp from your score file
        function formatTimestampFromFilename(timestampStr) {
            // Split the string into date and time parts.
            const parts = timestampStr.split('_'); // parts[0]: "YYYY-MM-DD", parts[1]: "HH-MM-SS"
            const datePart = parts[0];
            const timePart = parts[1].replace(/-/g, ':'); // change hyphens to colons
            const dateObj = new Date(datePart + ' ' + timePart);
            const options = { month: 'long', day: 'numeric', year: 'numeric' };
            const dateFormatted = dateObj.toLocaleDateString(undefined, options);
            const timeFormatted = dateObj.toLocaleTimeString();
            return `<i class="fas fa-running"></i> ${dateFormatted} at ${timeFormatted}`;
        }

        // Helper: Determine color based on score and category.
        function getColorForScore(score, category) {
            // For symmetry, higher is better; for stress and fatigue, lower is better.
            if (category === 'symmetry') {
                if (score >= 70) return 'green';
                else if (score >= 30) return 'yellow';
                else return 'red';
            } else {
                if (score <= 29) return 'green';
                else if (score <= 69) return 'yellow';
                else return 'red';
            }
        }

        // Helper: Create a single score circle element.
        function createScoreCircle(label, score, categoryClass) {
            const scoreItem = document.createElement('div');
            scoreItem.classList.add('score-item');
            const circleDiv = document.createElement('div');
            circleDiv.classList.add('score-circle', categoryClass);
            // Set the data-color attribute based on the score.
            circleDiv.setAttribute('data-color', getColorForScore(score, categoryClass));
            
            // Create and append the label.
            const labelDiv = document.createElement('div');
            labelDiv.classList.add('label');
            labelDiv.textContent = label;
            circleDiv.appendChild(labelDiv);
            
            // Create the inner SVG and number.
            const circleContent = document.createElement('div');
            circleContent.classList.add('circle-content');
            const perimeter = 251.2; // circumference for a circle with r=40
            const dashoffset = perimeter - (score / 100 * perimeter);
            circleContent.innerHTML = `
                <svg width="200" height="200" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="40" fill="none" stroke="#ddd" stroke-width="10" />
                    <g transform="rotate(-90,50,50)">
                        <circle class="foreground" cx="50" cy="50" r="40" fill="none" stroke="${getColorForScore(score, categoryClass)}" stroke-width="10" stroke-dasharray="${perimeter}" stroke-dashoffset="${dashoffset}" stroke-linecap="round" />
                    </g>
                </svg>
                <div class="number">${parseFloat(score).toFixed(2)}</div>`;
            circleDiv.appendChild(circleContent);
            scoreItem.appendChild(circleDiv);
            return scoreItem;
        }

        // Updated helper: Wraps a score circle with a details button and details box, and attaches the click event.
        function createScoreItem(label, score, categoryClass) {
            // Create the score circle element using your existing function.
            const scoreItem = createScoreCircle(label, score, categoryClass);
            
            // Create the details button.
            const detailsBtn = document.createElement('button');
            detailsBtn.classList.add('details-btn');
            detailsBtn.textContent = 'Details';
            
            // Create the details box.
            const detailsBox = document.createElement('div');
            detailsBox.classList.add('details-box');
            detailsBox.style.display = 'none'; // hidden by default
            detailsBox.style.textAlign = "left"; // new
            detailsBox.style.marginTop = "10px"; // new

            // Retrieve the score circle and its color.
            const scoreCircle = scoreItem.querySelector('.score-circle');
            const scoreColor = scoreCircle.getAttribute('data-color') || "green";

            // Set the side border color to match the score color.
            detailsBox.style.borderLeft = "5px solid " + scoreColor;
            detailsBox.style.paddingLeft = "10px";
            
            // Append the details button and details box to the score item.
            scoreItem.appendChild(detailsBtn);
            scoreItem.appendChild(detailsBox);
            
            // Attach the event listener that shows/hides the details.
            detailsBtn.addEventListener('click', function() {
                // Retrieve the score circle and its current color (set as data-color)
                const scoreCircle = scoreItem.querySelector('.score-circle');
                const scoreColor = scoreCircle.getAttribute('data-color') || "green";
                
                // Determine the category based on the class on the score circle.
                let category = "";
                if (scoreCircle.classList.contains('stress')) {
                    category = "stress";
                } else if (scoreCircle.classList.contains('symmetry')) {
                    category = "symmetry";
                } else if (scoreCircle.classList.contains('fatigue-left')) {
                    category = "fatigueLeft";
                } else if (scoreCircle.classList.contains('fatigue-right')) {
                    category = "fatigueRight";
                }
                
                // Toggle the display of the details box.
                if (detailsBox.style.display === 'none' || detailsBox.style.display === '') {
                    // Display the appropriate response.
                    detailsBox.textContent = responses[category][scoreColor];
                    detailsBox.style.display = 'block';
                    detailsBtn.textContent = 'Close';
                } else {
                    // Hide the details.
                    detailsBox.style.display = 'none';
                    detailsBtn.textContent = 'Details';
                }
            });
            
            return scoreItem;
        }

        // Helper: Retrieve the current user's profile from localStorage.
        function getUserProfile() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) return null;
            const profileJSON = localStorage.getItem('profile_' + currentUser);
            return profileJSON ? JSON.parse(profileJSON) : null;
        }

        // Helper: Retrieve the user's weight (in Newtons) from the profile.
        function getUserWeightNewtons() {
            const profile = getUserProfile();
            if (profile && profile.weight) {
                    const weightKg = Number(profile.weight) * 0.45359237;
                    return weightKg * 9.81;
            }
            return null;
        }

        // Recalculate Total_Stress for the home page using the globally stored rawScores.
        // This is used to update the home run stats box.
        // This function assumes that rawScores has been updated from the most recent file.
        function updateFinalStressScores() {
            // Retrieve the user's weight from the profile display (or storage)
            const profile = getUserProfile();
            if (!profile || !profile.weight) {
                console.error("User profile or weight not available; cannot compute Total_Stress.");
                return;
            }
            // Convert weight (in lbs) to kg then to Newtons.
            const weightKg = Number(profile.weight) * 0.45359237;
            const bodyweight_newtons = weightKg * 9.81;
            
            // Calculate the stress contributions from the raw scores.
            const R_Stress_final = rawScores.R_Stress / bodyweight_newtons;
            const L_Stress_final = rawScores.L_Stress / bodyweight_newtons;
            const totalStress = Math.min((R_Stress_final + L_Stress_final) / 2, 100);
            
            // Update the global scoreValues array:
            // [0] = Total_Stress, [1] = Symmetry_Score, [2] = Left_Fatigue, [3] = Right_Fatigue
            scoreValues = [
                totalStress,
                rawScores.Symmetry_Score || 0,
                rawScores.Left_Fatigue || 0,
                rawScores.Right_Fatigue || 0
            ];
            
            // Update the Home page's Stress display.
            const homeStressEl = document.getElementById('home-stress').querySelector('span');
            if (homeStressEl) {
                let stressStr = totalStress.toFixed(2); // e.g., "7.94"
                // If the string is longer than 5 characters, trim it.
                if (stressStr.length > 5) {
                    stressStr = stressStr.substring(0, 5);
                }
                homeStressEl.textContent = stressStr;
            }
            
            console.log("updateFinalStressScores: Total_Stress =", totalStress);
        }

        // --- Build/Rebuild the Scores Page ---
        // When a user is logged in, we want to use our recalculated Total_Stress from scoreValues[0].
        // Otherwise, we fall back to using the raw average from the file.
        async function loadAllScores() {
            console.log("loadAllScores triggered");
            try {
                const repoUrl = 'https://api.github.com/repos/PressureSole/srdesign/contents/scores';
                const response = await fetch(repoUrl);
                if (!response.ok) {
                    console.error('Failed to fetch scores folder.');
                    return;
                }
                const files = await response.json();
                // Filter files matching the pattern
                const scoreFiles = files.filter(file =>
                    /^scores_\d{4}-\d{2}-\d{2}_\d{2}-\d{2}-\d{2}\.txt$/.test(file.name)
                );
                if (scoreFiles.length === 0) {
                    console.error('No score files found.');
                    return;
                }

                // Sort newest → oldest by parsing timestamps
                //scoreFiles.sort((a, b) => {
                //    const tsA = a.name.slice("scores_".length, -".txt".length); 
                //    const tsB = b.name.slice("scores_".length, -".txt".length);
                //    const dateA = new Date(tsA.replace('_','T').replace(/-/g,':'));
                //    const dateB = new Date(tsB.replace('_','T').replace(/-/g,':'));
                //    return dateB - dateA;  // descending
                //});

                scoreFiles.sort((a, b) => {
                    const tsA = a.name.slice("scores_".length, -".txt".length); // e.g. "2025-03-30_12-00-00"
                    const tsB = b.name.slice("scores_".length, -".txt".length);
                    // Convert to ISO format by replacing '_' with 'T'
                    //const dateA = new Date(tsA.replace('_', 'T'));
                    //const dateB = new Date(tsB.replace('_', 'T'));
                    const [dateAString, timeAString] = tsA.split('_');
                    const [dateBString, timeBString] = tsB.split('_');
                    
                    // Convert the time part from "HH-MM-SS" to "HH:MM:SS"
                    const dateA = new Date(`${dateAString}T${timeAString.replace(/-/g, ':')}`);
                    const dateB = new Date(`${dateBString}T${timeBString.replace(/-/g, ':')}`);
                    return dateB - dateA; // Newest first
                });

                const scoresMainContainer = document.getElementById('scoresContainer');
                scoresMainContainer.innerHTML = '';

                let isFirst = true;
                for (const file of scoreFiles) {
                    const fileResponse = await fetch(file.download_url);
                    if (!fileResponse.ok) {
                        console.error('Failed to fetch file:', file.name);
                        continue;
                    }
                    const text = await fileResponse.text();
                    const lines = text.split('\n').filter(line => line.trim() !== '');
                    let newScores = {};
                    lines.forEach(line => {
                        const parts = line.split(':');
                        if (parts.length >= 2) {
                            newScores[parts[0].trim()] = parseFloat(parts[1].trim());
                        }
                    });

                    // For the *most recent* file, update global rawScores for the home page
                    if (isFirst) {
                        rawScores = {
                            R_Stress: newScores["R_Stress"] || 0,
                            L_Stress: newScores["L_Stress"] || 0,
                            Symmetry_Score: newScores["Symmetry_Score"] || 0,
                            Right_Fatigue: newScores["Right_Fatigue"] || 0,
                            Left_Fatigue: newScores["Left_Fatigue"] || 0
                        };
                        latestTimestamp = file.name.slice("scores_".length, -".txt".length);
                        isFirst = false;
                    }

                    // Build the DOM elements for this file
                    const containerDiv = document.createElement('div');
                    containerDiv.classList.add('scoreBox');

                    const headerDiv = document.createElement('div');
                    headerDiv.classList.add('score-header');
                    headerDiv.innerHTML = formatTimestampFromFilename(
                        file.name.slice("scores_".length, -".txt".length)
                    );
                    containerDiv.appendChild(headerDiv);

                    const circlesDiv = document.createElement('div');
                    circlesDiv.classList.add('scores-container');

                    // Compute stress for THIS file's data
                    let stressValue = 0;
                    if (localStorage.getItem('currentUser')) {
                        const weightNewtons = getUserWeightNewtons();
                        if (weightNewtons) {
                            const R = newScores["R_Stress"] || 0;
                            const L = newScores["L_Stress"] || 0;
                            const R_Stress_final = R / weightNewtons;
                            const L_Stress_final = L / weightNewtons;
                            stressValue = Math.min((R_Stress_final + L_Stress_final) / 2, 100);
                        } else {
                            stressValue = ((newScores["R_Stress"]||0)+(newScores["L_Stress"]||0))/2;
                        }
                    } else {
                        // Not logged in: raw average
                        stressValue = ((newScores["R_Stress"]||0)+(newScores["L_Stress"]||0))/2;
                    }

                    circlesDiv.appendChild(createScoreItem('Stress', stressValue, 'stress'));
                    circlesDiv.appendChild(
                        createScoreItem('Symmetry', newScores["Symmetry_Score"]||0, 'symmetry')
                    );
                    circlesDiv.appendChild(
                        createScoreItem('Fatigue (Left)', newScores["Left_Fatigue"]||0, 'fatigue-left')
                    );
                    circlesDiv.appendChild(
                        createScoreItem('Fatigue (Right)', newScores["Right_Fatigue"]||0, 'fatigue-right')
                    );

                    containerDiv.appendChild(circlesDiv);
                    // Append so the first file remains on top, older ones go below
                    scoresMainContainer.appendChild(containerDiv);
                }
            } catch (error) {
                console.error("Error loading scores:", error);
            }
        }

        // Call loadAllScores when the document is ready.
        document.addEventListener('DOMContentLoaded', function() {
            loadAllScores();
        });

        // HOME Page -----------------------------------------------------------------------
        // Set up the click event on the home page button.
        document.getElementById('home-profile-btn').addEventListener('click', function() {
            if (localStorage.getItem('currentUser')) {
                // If user is logged in, show the profile tab and display the user's profile.
                showPage('profile');
                document.getElementById('signup-login-container').style.display = 'none';
                document.getElementById('your-profile').style.display = 'block';
            } else {
                // If not logged in, take user to the profile tab (which shows sign up / log in forms).
                showPage('profile');
            }
        });

        // Ensure the button state is correct when the page loads.
        document.addEventListener('DOMContentLoaded', function() {
            localStorage.removeItem('currentUser');
            updateHomeProfileButton();
        });
        
        function updateHomeRunStats(timestampPart) {
            const homeTimestampCst = document.getElementById('home-timestamp');
            // Check if a user is logged in
            if (!localStorage.getItem('currentUser')) {
                // User is not logged in: set default values
                homeTimestampCst.innerHTML = `<i class="fas fa-running"></i> –––`;
                document.getElementById('home-stress').querySelector('span').textContent = "0";
                document.getElementById('home-symmetry').querySelector('span').textContent = "0";
                document.getElementById('home-fatigue-left').querySelector('span').textContent = "0";
                document.getElementById('home-fatigue-right').querySelector('span').textContent = "0";
                return; // exit the function without doing any further updates
            }
            
            // If a timestamp is provided, use it.
            if (timestampPart) {
                homeTimestampCst.innerHTML = formatTimestampFromFilename(timestampPart);
            } else if (latestTimestamp) {
                // If no parameter but we have a stored timestamp, use that.
                homeTimestampCst.innerHTML = formatTimestampFromFilename(latestTimestamp);
            } else {
                // Fallback placeholder if no timestamp is available.
                homeTimestampCst.innerHTML = `<i class="fas fa-running"></i> –––`;
            }

            // Get the stat items from the home page.
            const homeStress = document.getElementById('home-stress');
            const homeSymmetry = document.getElementById('home-symmetry');
            const homeFatigueLeft = document.getElementById('home-fatigue-left');
            const homeFatigueRight = document.getElementById('home-fatigue-right');

            // Helper functions for color logic:
            function getColorForLowerBetter(score) {
                if (score <= 29) {
                    return 'green';
                } else if (score <= 69) {
                    return 'yellow';
                } else {
                    return 'red';
                }
            }
            function getColorForHigherBetter(score) {
                if (score >= 70) {
                    return 'green';
                } else if (score >= 30) {
                    return 'yellow';
                } else {
                    return 'red';
                }
            }

            // Extract the scores from your scoreValues array.
            // In your code, scoreValues is defined as [stressScore, symmetryScore, fatigueScore].
            // Since you want the order Stress, Fatigue, Symmetry on the home page, note the difference.
            const stressScore = scoreValues[0];
            const symmetryScore = scoreValues[1];
            const fatigueLeft = scoreValues[2];
            const fatigueRight = scoreValues[3];

            // Update the home page items:
            // For stress and fatigue, lower is better.
            homeStress.querySelector('span').textContent = parseFloat(stressScore).toFixed(2);
            homeStress.querySelector('span').style.color = getColorForLowerBetter(stressScore);
            

            homeFatigueLeft.querySelector('span').textContent = fatigueLeft;
            homeFatigueLeft.querySelector('span').style.color = getColorForLowerBetter(fatigueLeft);

            homeFatigueRight.querySelector('span').textContent = fatigueRight;
            homeFatigueRight.querySelector('span').style.color = getColorForLowerBetter(fatigueRight);

            // For symmetry, higher is better.
            homeSymmetry.querySelector('span').textContent = symmetryScore;
            homeSymmetry.querySelector('span').style.color = getColorForHigherBetter(symmetryScore);

            homeStress.querySelector('span').style.textShadow = "1px 1px 2px rgba(0,0,0,0.5)";
            homeSymmetry.querySelector('span').style.textShadow = "1px 1px 2px rgba(0,0,0,0.5)";
            homeFatigueLeft.querySelector('span').style.textShadow = "1px 1px 2px rgba(0,0,0,0.5)";
            homeFatigueRight.querySelector('span').style.textShadow = "1px 1px 2px rgba(0,0,0,0.5)";
            
            // Update the new timestamp element if a timestamp is provided.
            if (timestampPart) {
                const homeTimestampEl = document.getElementById('home-timestamp');
                homeTimestampEl.innerHTML = formatTimestampFromFilename(timestampPart);
            }
        }

        // SCORES Page ---------------------------------------------------------------------

        // Define score variables (temporary default values)
        // Temporary default test values
        let stressScore = 0;
        let symmetryScore = 0;
        let fatigueLeft = 0;
        let fatigueRight = 0;
        
        // Array of scores in order: Stress, Symmetry, Fatigue
        let scoreValues = [stressScore, symmetryScore, fatigueLeft, fatigueRight];

        function updateScoreCircles() {
            const circles = document.querySelectorAll('.score-circle');
            const perimeter = 251.2; // Circumference for a circle with r = 40

            circles.forEach((circle, index) => {
                let score = scoreValues[index];
                const bar = circle.querySelector('svg circle.foreground');
                if (!bar) {
                    console.error("Foreground circle not found");
                    return;
                }
                
                // Set the dasharray and dashoffset so the arc length represents the score percentage
                bar.setAttribute('stroke-dasharray', perimeter);
                bar.setAttribute('stroke-dashoffset', perimeter - (score / 100 * perimeter));

                // Determine the stroke color based on score and category.
                let color;
                if (circle.classList.contains('symmetry')) {
                    // For symmetry, higher is better.
                    if (score >= 70) {
                        color = 'green';
                    } else if (score >= 30) {
                        color = 'yellow';
                    } else {
                        color = 'red';
                    }
                } else {
                    // For stress and fatigue, lower is better.
                    if (score <= 29) {
                        color = 'green';
                    } else if (score <= 69) {
                        color = 'yellow';
                    } else {
                        color = 'red';
                    }
                }
                bar.style.stroke = color;

                // Set a data attribute for the score color for later use in the details box.
                circle.setAttribute('data-color', color);

                // Update the displayed number in the center.
                const numberEl = circle.querySelector('.number');
                if (numberEl) {
                    numberEl.textContent = score;
                }
            });
        }
        
        // DETAILS BUTTON

        // Mapping of detailed responses for each category and color
        const responses = {
            stress: {
                green: "Great job! Your stress levels are low, meaning the impact on your feet is well-distributed and not excessive. This suggests that your running form and footwear are effectively managing ground forces, reducing the risk of overuse injuries. Keep up the good work, and continue practicing proper foot strike and posture to maintain this balance!",
                yellow: "Your stress levels are moderate, indicating that some areas of your feet may be experiencing increased pressure during your run. This could be due to factors such as uneven weight distribution, fatigue, or slight inefficiencies in form. Consider checking your footwear, focusing on even foot strikes, and incorporating strength or mobility exercises to improve impact absorption.",
                red: "High stress levels detected! This means that certain areas of your feet are absorbing excessive impact, which could increase the risk of discomfort or injury over time. Possible causes include improper form, worn-out shoes, or excessive training intensity. You may want to reassess your footwear, adjust your stride mechanics, or incorporate recovery strategies to reduce strain on your feet."
            },
            symmetry: {
                green: "Excellent symmetry! Your left and right sides are well-balanced, meaning your foot strike and weight distribution are even. This helps improve efficiency, reduce strain on one side of your body, and lower the risk of compensatory injuries. Keep maintaining strong biomechanics and balanced strength training to preserve this symmetry!",
                yellow: "Your symmetry score suggests some imbalance between your left and right sides. This could be due to muscle imbalances, fatigue, or slight inefficiencies in your stride. While not a major concern yet, it’s worth paying attention to any discomfort or overuse on one side. Strengthening weaker muscles, focusing on even foot strikes, and incorporating single-leg exercises may help improve your balance over time.",
                red: "Significant asymmetry detected! A major imbalance in your running form could lead to uneven stress on your joints and muscles, increasing the risk of injury. Possible causes include past injuries, muscle weaknesses, or poor movement patterns. Consider consulting a specialist or incorporating targeted strength and mobility work to correct imbalances and enhance your running efficiency."
            },
            fatigueLeft: {
                green: "Your fatigue levels are low, meaning your feet are handling the demands of your run well. This suggests that your muscles and biomechanics are efficiently managing workload without excessive strain. Keep up your current training routine and recovery practices to maintain endurance and prevent overuse injuries.",
                yellow: "Moderate fatigue detected. This means your feet are starting to show signs of stress, which could lead to decreased efficiency and increased risk of discomfort over longer distances. Consider incorporating proper warm-ups, strength training, and post-run recovery techniques like stretching or massage to help manage fatigue and sustain performance.",
                red: "High fatigue levels detected! Your feet are likely experiencing significant strain, which could negatively impact your running form and increase injury risk. This may be due to overtraining, insufficient recovery, or inefficient biomechanics. It’s a good idea to assess your training load, prioritize rest, and focus on strengthening your feet and lower legs to improve endurance and reduce strain over time."
            },
            fatigueRight: {
                green: "Your fatigue levels are low, meaning your feet are handling the demands of your run well. This suggests that your muscles and biomechanics are efficiently managing workload without excessive strain. Keep up your current training routine and recovery practices to maintain endurance and prevent overuse injuries.",
                yellow: "Moderate fatigue detected. This means your feet are starting to show signs of stress, which could lead to decreased efficiency and increased risk of discomfort over longer distances. Consider incorporating proper warm-ups, strength training, and post-run recovery techniques like stretching or massage to help manage fatigue and sustain performance.",
                red: "High fatigue levels detected! Your feet are likely experiencing significant strain, which could negatively impact your running form and increase injury risk. This may be due to overtraining, insufficient recovery, or inefficient biomechanics. It’s a good idea to assess your training load, prioritize rest, and focus on strengthening your feet and lower legs to improve endurance and reduce strain over time."
            }
        };

        document.querySelectorAll('.details-btn').forEach(button => {
            button.addEventListener('click', function() {
                // Get the parent container (.score-item)
                const container = this.closest('.score-item');
                const detailsBox = container.querySelector('.details-box');
                const scoreCircle = container.querySelector('.score-circle');
                const scoreColor = scoreCircle.getAttribute('data-color');
                
                // Determine category based on score-circle's classes
                let category = "";
                if (scoreCircle.classList.contains('stress')) {
                    category = "stress";
                } else if (scoreCircle.classList.contains('symmetry')) {
                    category = "symmetry";
                } else if (scoreCircle.classList.contains('fatigue-left')) {
                    category = "fatigueLeft";
                } else if (scoreCircle.classList.contains('fatigue-right')) {
                    category = "fatigueRight";
                }
                
                // Toggle the details box visibility and update button text
                if (detailsBox.style.display === 'none' || detailsBox.style.display === '') {
                    // Show details and update the button label to "Close"
                    detailsBox.textContent = responses[category][scoreColor];
                    detailsBox.style.display = 'block';
                    this.textContent = "Close";
                } else {
                    // Hide details and revert button text to "Details"
                    detailsBox.style.display = 'none';
                    this.textContent = "Details";
                }
            });
        });

        // TEMPORARY function to prompt for new SCORES
        function testScoreInput() {
            let newStress = prompt("Enter Stress score (0-100):", stressScore);
            let newSymmetry = prompt("Enter Symmetry score (0-100):", symmetryScore);
            let newFatigueLeft = prompt("Enter Fatigue (Left) score (0-100):", fatigueLeft);
            let newFatigueRight = prompt("Enter Fatigue score (Right) (0-100):", fatigueRight);
            scoreValues = [Number(newStress), Number(newSymmetry), Number(newFatigueLeft), Number(newFatigueRight)];
            
            // Store the run scores in localStorage so they persist.
            localStorage.setItem('runScores', JSON.stringify(scoreValues));

            updateScoreCircles();
            updateHomeRunStats(); // Update the home page "Your Last Run" box
            updateRunHistory();   // Update the Run History table with new scores
        }

        // Initial update
        //updateScoreCircles();
        //testScoreInput();

        // PROFILE Page ---------------------------------

        // Reusable function to attach a toggle event listener to a password field
        function setupTogglePassword(inputID, iconID) {
            const inputField = document.getElementById(inputID);
            const icon = document.getElementById(iconID);
            icon.addEventListener('click', function() {
                if (inputField.type === "password") {
                inputField.type = "text";
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
                } else {
                inputField.type = "password";
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Attach toggle for Sign Up form
            setupTogglePassword('signup-password', 'signup-toggle-password');
            // Attach toggle for Log In form
            setupTogglePassword('login-password', 'login-toggle-password');
            // Attach toggle for Your Profile form (it remains attached even if hidden initially)
            setupTogglePassword('display-password', 'profile-toggle-password');

            // For Sign Up password field:
            document.getElementById('signup-password').addEventListener('input', function() {
                const icon = document.getElementById('signup-toggle-password');
                if (this.value.length > 0) {
                    icon.style.display = "inline-block";
                } else {
                    icon.style.display = "none";
                }
            });

            // For Log In password field:
            document.getElementById('login-password').addEventListener('input', function() {
                const icon = document.getElementById('login-toggle-password');
                if (this.value.length > 0) {
                    icon.style.display = "inline-block";
                } else {
                    icon.style.display = "none";
                }
            });

            // For Your Profile password field:
            //document.getElementById('display-password').addEventListener('input', function() {
            //    const icon = document.getElementById('profile-toggle-password');
                // In the profile form, we want the toggle icon to be visible only during editing
                // So if the field is in edit mode (i.e. not readonly) and has text, show the icon.
            //    if (this.value.length > 0 && !this.hasAttribute('readonly')) {
            //        icon.style.display = "inline-block";
            //    } else {
            //        icon.style.display = "none";
            //    }
            //});

            // Log In functionality
            document.getElementById('login-form').addEventListener('submit', async function(event) {
                event.preventDefault();
                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value.trim();
                const storedProfile = localStorage.getItem('profile_' + username);
                if (!storedProfile) {
                alert("No profile found for this username.");
                return;
                }
                const profileData = JSON.parse(storedProfile);
                if (profileData.password !== password) {
                alert("Incorrect password.");
                return;
                }

                // Set the currentUser flag.
                localStorage.setItem('currentUser', username);
                // Immediately update the UI on the affected pages
                ['visualizations', 'gait-mechanics', 'scores'].forEach(checkAuth);

                document.getElementById('signup-login-container').style.display = 'none';
                document.getElementById('display-username').value = profileData.username;
                document.getElementById('display-password').value = profileData.password;
                document.getElementById('display-first-name').value = profileData.firstName;
                document.getElementById('display-last-name').value = profileData.lastName;
                document.getElementById('display-weight').value = profileData.weight;
                document.getElementById('your-profile').style.display = 'block';

                // After setting up the profile fields:
                await loadAllScores();           // Rebuild the scores page (wait for it to complete).
                updateFinalStressScores();       // Recalculate Total_Stress and update scoreValues.
                updateHomeRunStats();            // Update the home page stats.
                //updateScoreCircles();            // Update any score circle visuals.
                updateHomeProfileButton();       // Update the home button appearance.
            });
            
            // Sign Up functionality
            document.getElementById('signup-form').addEventListener('submit', async function(event) {
                event.preventDefault();
                const username = document.getElementById('signup-username').value.trim();
                const password = document.getElementById('signup-password').value.trim();
                const firstName = document.getElementById('first-name').value.trim();
                const lastName = document.getElementById('last-name').value.trim();
                const weight = document.getElementById('weight').value.trim();
                if (!username || !password || !firstName || !lastName || !weight) {
                alert("Please fill out all fields.");
                return;
                }
                if (localStorage.getItem('profile_' + username)) {
                alert("This username already exists. Please choose a different username or log in.");
                return;
                }
                const profileData = {
                username: username,
                password: password,
                firstName: firstName,
                lastName: lastName,
                weight: weight,
                };
                localStorage.setItem('profile_' + username, JSON.stringify(profileData));

                // Set the currentUser flag.
                localStorage.setItem('currentUser', username);
                // Immediately update the UI on the affected pages
                ['visualizations', 'gait-mechanics', 'scores'].forEach(checkAuth);

                document.getElementById('signup-login-container').style.display = 'none';
                document.getElementById('display-username').value = username;
                document.getElementById('display-password').value = password;
                document.getElementById('display-first-name').value = firstName;
                document.getElementById('display-last-name').value = lastName;
                document.getElementById('display-weight').value = weight;
                document.getElementById('your-profile').style.display = 'block';

                // After setting up the profile fields:

                await loadAllScores();           // Rebuild the scores page (wait for it to complete).
                updateFinalStressScores();       // Recalculate Total_Stress and update scoreValues.
                updateHomeRunStats();            // Update the home page stats.
                //updateScoreCircles();            // Update any score circle visuals.
                updateHomeProfileButton();       // Update the home button appearance.
            });
            
            // Toggle between Edit and Save Profile modes on the "Your Profile" page
            document.getElementById('edit-profile-btn').addEventListener('click', function() {
                const usernameInput = document.getElementById('display-username');
                const passwordInput = document.getElementById('display-password');
                const firstNameInput = document.getElementById('display-first-name');
                const lastNameInput = document.getElementById('display-last-name');
                const weightInput = document.getElementById('display-weight');
                const profileToggleIcon = document.getElementById('profile-toggle-password');

                if (this.innerText === "Edit Profile") {
                    // Switch to edit mode
                    usernameInput.removeAttribute('readonly');
                    passwordInput.removeAttribute('readonly');
                    firstNameInput.removeAttribute('readonly');
                    lastNameInput.removeAttribute('readonly');
                    weightInput.removeAttribute('readonly');

                    // Force the eye icon to show so the user can toggle password visibility
                    profileToggleIcon.style.display = "inline-block";
                    profileToggleIcon.style.zIndex = "100";

                    this.innerText = "Save Profile";
                } else {
                    // Validate and save the profile data
                    const username = usernameInput.value.trim();
                    const password = passwordInput.value.trim();
                    const firstName = firstNameInput.value.trim();
                    const lastName = lastNameInput.value.trim();
                    const weight = weightInput.value.trim();
                    if (!username || !password || !firstName || !lastName || !weight) {
                        alert("Please fill out all fields before saving.");
                        return;
                    }
                    const profileData = {
                        username: username,
                        password: password,
                        firstName: firstName,
                        lastName: lastName,
                        weight: weight,
                    };
                    localStorage.setItem('profile_' + username, JSON.stringify(profileData));

                    // Switch back to read-only mode
                    usernameInput.setAttribute('readonly', true);
                    passwordInput.setAttribute('readonly', true);
                    firstNameInput.setAttribute('readonly', true);
                    lastNameInput.setAttribute('readonly', true);
                    weightInput.setAttribute('readonly', true);

                    passwordInput.type = "password";
                    
                    // Hide the toggle icon now that editing is finished
                    profileToggleIcon.style.display = "none";

                    this.innerText = "Edit Profile";
                    alert("Profile saved successfully!");
                }
            });
            // Add event listener for the Log Out button
            document.getElementById('logout-btn').addEventListener('click', function() {
                // Hide the profile view container
                document.getElementById('your-profile').style.display = 'none';
                // Show the sign up / log in container (assuming its id is "signup-login-container")
                document.getElementById('signup-login-container').style.display = 'flex';

                // Clear the sign up form
                document.getElementById('signup-form').reset();
                // Clear the log in form
                document.getElementById('login-form').reset();
            });
            function updateRunHistory() {
                // Assuming scoreValues is defined as: [stressScore, symmetryScore, fatigueScore]
                const stressVal = scoreValues[0];
                const symmetryVal = scoreValues[1];
                const fatigueVal = scoreValues[2];
                
                document.getElementById('run-stress').innerText = stressVal;
                document.getElementById('run-symmetry').innerText = symmetryVal;
                document.getElementById('run-fatigue').innerText = fatigueVal;
            }

            //loadScoresFromFile();
            //testScoreInput(); Comment out for until auto file load works

            // Check if run scores are already stored
            //const storedRunScores = localStorage.getItem('runScores');
            //if (!storedRunScores || storedRunScores === '[]') {
            //testScoreInput();
            //} else {
            //    scoreValues = JSON.parse(storedRunScores);
            //    updateScoreCircles();
            //    updateHomeRunStats();
            //    updateRunHistory();
            //}
        });

        
        // TEMPORARY function to view all saved profiles
            function showProfiles() {
                const outputDiv = document.getElementById('profiles-output');
                outputDiv.innerHTML = ''; // Clear previous output
                // Loop through localStorage keys
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    // Check for keys that start with "profile_"
                    if (key.indexOf('profile_') === 0) {
                        const profile = JSON.parse(localStorage.getItem(key));
                        outputDiv.innerHTML += `<p><strong>${key}</strong>: ${JSON.stringify(profile)}</p>`;
                    }
                }
            }

        // Temporary function to clear all stored profiles
        function clearProfiles() {
            // Loop backwards through localStorage keys to safely remove items
            for (let i = localStorage.length - 1; i >= 0; i--) {
                const key = localStorage.key(i);
                if (key.indexOf('profile_') === 0) {
                    localStorage.removeItem(key);
                }
            }
            // Update the output to reflect the cleared profiles
            document.getElementById('profiles-output').innerHTML = 'All profiles have been cleared.';
        }

        // FAQs Page ------------------------------------------------------------------------- 
        document.addEventListener('DOMContentLoaded', function() {
            // Attach click event to each FAQ box so each toggles only its own answer
            document.querySelectorAll('.faq-box').forEach(function(box) {
                box.addEventListener('click', function(event) {
                event.stopPropagation();
                var answer = this.querySelector('.faq-answer');
                // Toggle display for this box's answer
                answer.style.display = (answer.style.display === "block") ? "none" : "block";
                });
            });
        });
    </script>
</body>
</html>
