<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PressureSole App</title>
    <!--<script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-p+..." crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            overflow-x: hidden; /* Prevents horizontal scrolling */
        }

        .navbar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: #bbb;
            padding: 10px 0;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;  /* Nav Bar will always appear on top */
        }

        .tab {
            text-align: center;
            color: black;
            padding: 10px;
            flex-grow: 1;
            cursor: pointer;
            font-weight: bold;
        }

        .tab:hover {
            background-color: #777;
        }

        .tab i {
            font-size: 24px;
            display: block;
            margin-bottom: 5px;
        }

        .content {
            display: none;
            text-align: center;
            margin-top: 120px;
            /*padding-top: 80px;*/

        }

        .active {
            display: block;
        }

        .resized-image {
            width: 300px;   /* Set the width of the image */
            height: auto;   /* Keep the aspect ratio intact */
            margin: 20px 0; /* Add top and bottom margins */
        }

        .logo-tab {
            padding: 0; /* Remove extra padding */
        }       

        .logo-image {
            height: 40px; /* Adjust size as needed */
            width: auto;
        }

        /* HOME Page Styling --------------------------------------------------------- */

        .container {
            display: flex;
            width: 100vw; /* Full width of the viewport */
            height: 100%; /* Adjust height to account for navbar */
            padding: 0; /* Remove default padding */
            margin: 0;  /* Remove default margin */
            box-sizing: border-box; /* Ensure padding does not affect width */
        }

        .left-half {
            width: 50%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center; 
            padding: 20px;
            box-sizing: border-box;
        }   

        .right-half {
            width: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center; /* This centers the content vertically */
            padding: 20px;
            box-sizing: border-box;
            background-color: white; /* White background for the right half */
            /*border: 1px solid red;*/
        }

        .left-half h1 {
            font-size: 42px;
            color: #333;
        }

        .left-half p {
            font-size: 18px;
            color: #555;
            margin-bottom: 20px;
        }

        .cta-button {
            background-color: #ff5500; /* Strava's signature orange */
            color: white;
            padding: 15px 25px;
            font-size: 18px;
            font-weight: bold;
            text-decoration: none;
            border-radius: 10x;
            display: inline-block;
            margin-top: 20px;
        }

        /* Right Half - Run Stats */
        .stats-box {
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 10px;
        }

        .stats-box h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            color: #555;
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-item span {
            display: block;
            font-size: 24px;
            font-weight: bold;
            color: #222;
        }
            
        /* SCORES Page styling ------------------------------------------------------------- */
        .scores-container {
            display: flex;
            justify-content: space-evenly;  /* Distribute circles evenly */
            width: 100%;                    /* Full width */
            margin: 50px 20px 0;            /* Increased top margin to move the circles down */
            align-items: center;            /* Vertically center the circles */
        }

        .score-circle {
            position: relative;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: #eaeaea;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .score-circle .label {
            position: absolute;
            top: -25px; /* Position the label above the circle */
            font-size: 18px;
            font-weight: bold;
        }

        .score-circle .circle-content {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .score-circle .number {
            position: absolute;
            font-size: 36px;
            font-weight: bold;
            z-index: 2; /* Ensure number stays on top of the bar */
        }

        .score-circle svg .foreground {
            transform: rotate(0deg); /*-90deg*/
            transform-origin: 50% 50%;
        }

        /* General styling for the bars */
        .score-circle .bar {
            transition: stroke-dasharray 0.5s ease;
            transform: rotate(0deg); /* Start from the top */
        }


        /* Updated Stress, Symmetry, Fatigue Bar Color Styling */
        .score-circle.stress .bar {
            stroke-dasharray: 6, 440; /* Example calculation for 6% */
            stroke: green;
        }

        .score-circle.symmetry .bar {
            stroke-dasharray: 85, 440; /* Example calculation for 85% */
            stroke: green;
        }

        .score-circle.fatigue .bar {
            stroke-dasharray: 31, 440; /* Example calculation for 31% */
            stroke: green;
        }

        /* Ensure the correct colors and values are applied */
        .score-circle.stress[data-value="6"] .bar {
            stroke: green;
            stroke-dasharray: 26, 440;
        }

        .score-circle.symmetry[data-value="85"] .bar {
            stroke: green;
            stroke-dasharray: 374, 440;
        }

        .score-circle.fatigue[data-value="31"] .bar {
            stroke: green;
            stroke-dasharray: 136, 440;
        }

        /* Styling for the numbers in the center */
        .score-circle .number {
            font-size: 36px;
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Details Button styling */
        /* Container for each score item */
        .score-item {
            position: relative; /* Makes it the reference for absolute positioning */
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }

        /* Details Button styling (remains similar) */
        .details-btn {
            background-color: #eaeaea;
            color: #333;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        /* Hover state for the Details button */
        .details-btn:hover {
            background-color: #ccc;
        }

        /* Details Box styling - now absolutely positioned so it doesn't shift other elements */
        .details-box {
            position: absolute;
            /* flex-direction: column; /* TESTING CHANGES (delete) */
            /* align-items: center; /* TESTING CHANGES (delete) */
            top: 100%;  /* Position immediately below the score-item content */
            /*left: 0;*/ 
            width: 150%; /* TESTING CHANGES (100%) */
            background-color: #eaeaea;
            color: #333;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
            font-size: 16px;
            display: none; /* Hidden by default */
            z-index: 10; /* Ensures it overlays content if needed */
        }
        
        /* PROFILE Page styling -------------------------------------------------------------- */
        .profile-container {
            max-width: 1000px;
            margin: auto; /*50px*/
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        /* Form layout */
        
        .profile-form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    
        /* Form rows should have uniform padding and spacing */
        .form-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: calc(100% - 10px); /* Ensures row width is correct without breaking layout */
            padding: 0 0px; /* Uniform left and right padding for all rows */
            gap: 10px; /* Ensures spacing between form fields */
            margin-bottom: 15px; /* Space between rows */
            box-sizing: border-box; /* Ensures padding does not affect overall width */
        }

        /* Form groups (input containers) should distribute space equally */
        .form-group {
            flex: 1;
            min-width: 0; /* Prevents overflow */
        }

        /* Style for input fields */
        .profile-form input,
        .profile-form select {
            width: 100%;
            padding: 12px; /* Consistent padding inside input boxes */
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #eaeaea; /* Light grey background */
            font-size: 16px;
            color: #333;
            box-sizing: border-box; /* Ensures padding does not break width */
        }

        /* Labels */
        .profile-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        /* Save button */
        .profile-form button {
            width: calc(100% - 10px);
            padding: 10px;
            background-color: #ff5500; /* Strava's orange */
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
        }

        .profile-form button:hover {
            background-color: #e04a00;
        }
        
        input[type="password"]::-ms-reveal,
        input[type="password"]::-ms-clear {
            display: none;
        }
        
        input[type="password"]::-webkit-textfield-decoration-container {
            display: none;
        }
        
        input[type="password"]::-webkit-credentials-auto-fill-button {
            display: none !important;
        }
        
        /* FAQs Page styling -------------------------------------------------------------- */

        /* Container for the two FAQ columns */
        .faq-columns {
        display: flex;
        gap: 20px;
        justify-content: center;
        }

        /* Left and right column styles */
        .faq-column-left,
        .faq-column-right {
        display: flex;
        flex-direction: column;
        gap: 20px;
        flex: 1;
        }

        /* FAQ box styling */
        .faq-box {
        background-color: #f0f0f0;
        border-radius: 10px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        }

        /* FAQ question heading */
        .faq-box h3 {
        max-width: 90%;   
        margin: 0 auto;
        font-weight: bold;
        text-align: Left;
        }

        /* FAQ answer styling (hidden by default) */
        .faq-answer {
        margin-top: 10px;
        max-width: 90%; /* or any value you prefer */
        margin-left: auto;
        margin-right: auto; /* this centers the container within its parent */
        display: none;
        text-align: left;
        }
    </style>
</head>

<body>
    <!-- NAV BAR -------------------------------------------------------------------- -->
    <div class="navbar">
        <div class="tab logo-tab" onclick="showPage('home')">
            <img src="PressureSoleLogo_FullTransp.png" alt="PressureSole Logo" class="logo-image"/>
        </div>
        <div class="tab" onclick="showPage('visualizations')">
            <i class="fas fa-chart-line"></i>
            <span>Visualizations</span>
        </div>
        <div class="tab" onclick="showPage('gait-mechanics')">
            <i class="fas fa-running"></i>
            <span>Gait Mechanics</span>
        </div>
        <div class="tab" onclick="showPage('scores')">
            <i class="fas fa-star"></i>
            <span>Scores</span>
        </div>
        <div class="tab" onclick="showPage('profile')">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </div>
        <div class="tab" onclick="showPage('faqs')">
            <i class="fas fa-question-circle"></i>
            <span>FAQ's</span>
        </div>
    </div>
    
    <!-- Home tab -->
    <div id="home" class="content active">
        <div class="container">
            <!-- Left Half - Branding & Features -->
            <div class="left-half">
                <h1>Welcome to PressureSole</h1>
                <h2>Real-time Gait Tracking</h2>
                <p>Monitor your running mechanics with live feedback and optimize your performance.</p>
                <!-- I want the Sign Up / Log In button here -->
            </div>
            <!-- Right Half - "Your Last Run" Stats -->
            <div class="right-half">
                <div class="stats-box">
                    <h2>Your Last Run</h2>
                    <div class="stats">
                        <div class="stat-item" id="home-stress">
                            <span>0</span> Stress
                        </div>
                        <div class="stat-item" id="home-symmetry">
                            <span>0</span> Symmetry
                        </div>
                        <div class="stat-item" id="home-fatigue-left">
                            <span>0</span> Fatigue (Left)
                        </div>
                        <div class="stat-item" id="home-fatigue-right">
                            <span>0</span> Fatigue (Right)
                        </div>
                    </div>
                </div>
                <a href="#" class="cta-button" onclick="showPage('scores'); return false;">View Your Scores</a>
            </div>
        </div>
    </div>

    <!-- COMMENT OUT FOR NOW
    <div id="home" class="content active">
        <h1>Welcome to PressureSole</h1>
        <h2>Real-time Gait Tracking</h2>
        <p>See your latest run and feedback here.</p>
<<<<<<< HEAD
        <img src="PressureSoleLogo_Full.jpg" alt="logo full" class="resized-image"/>
=======
        <img src="srdesign2/srdesign/images/PressureSoleLogo_Full.jpg" alt="logo full" class="resized-image"/>
>>>>>>> a941849e38387b1ec1b5565716114cb65622b769
    </div>
    -->
    
<!--data tab-->
<div id="visualizations" class="content" style="font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f4;">
    <h1 style="text-align: center; color: #333;">Score Visualizations</h1>

    <!-- Buttons for switching views and updating visualizations -->
    <div style="text-align: center; margin-bottom: 20px;">
        <button id="switch-view-btn" onclick="switchView()" style="padding: 10px 20px; background-color: #2a9d8f; color: white; border: none; border-radius: 5px; cursor: pointer;">
            Switch to Gradient View
        </button>
    </div>

    <!-- Section View -->
    <div id="section-view" style="display: block;">
        <div style="display: flex; justify-content: space-between; gap: 20px;">
            <!-- Symmetry Section -->
            <div id="symmetry-section" style="flex: 1; padding: 20px; border-radius: 10px; background: white; box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); text-align: center;">
                <h2 style="color: #2a9d8f; border-bottom: 2px solid #2a9d8f; padding-bottom: 10px;">Symmetry</h2>
                <div id="symmetry-images" style="text-align: center;">
                    <!-- Symmetry images will be inserted here -->
                </div>
            </div>
            <!-- Fatigue Section -->
            <div id="fatigue-section" style="flex: 1; padding: 20px; border-radius: 10px; background: white; box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); text-align: center;">
                <h2 style="color: #e76f51; border-bottom: 2px solid #e76f51; padding-bottom: 10px;">Fatigue</h2>
                <div id="fatigue-images" style="text-align: center;">
                    <!-- Fatigue images will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Gradient View -->
    <div id="gradient-view" style="display: none;">
        <div style="display: flex; justify-content: space-between; gap: 20px;">
            <!-- Symmetry Gradient -->
            <div id="symmetry-gradient" style="flex: 1; padding: 20px; border-radius: 10px; background: white; box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); text-align: center;">
                <h2 style="color: #2a9d8f; border-bottom: 2px solid #2a9d8f; padding-bottom: 10px;">Symmetry</h2>
                <div id="symmetry-gradient-images" style="text-align: center;">
                    <!-- Symmetry gradient images will be inserted here -->
                </div>
            </div>
            <!-- Fatigue Gradient -->
            <div id="fatigue-gradient" style="flex: 1; padding: 20px; border-radius: 10px; background: white; box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); text-align: center;">
                <h2 style="color: #e76f51; border-bottom: 2px solid #e76f51; padding-bottom: 10px;">Fatigue</h2>
                <div id="fatigue-gradient-images" style="text-align: center;">
                    <!-- Fatigue gradient images will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        function formatTimestamp(filename) {
            // Extract the timestamp part from the filename
            const timestampMatch = filename.match(/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/);
            
            if (!timestampMatch) {
                return "Invalid timestamp format";
            }
            
            // Destructure the matched groups
            const [, year, month, day, hours, minutes, seconds] = timestampMatch;
            
            // Create a Date object 
            // Note: Month is 0-indexed in JavaScript Date, so subtract 1 from month
            const date = new Date(year, month - 1, day, hours, minutes, seconds);
            
            // Use toLocaleString for local formatting
            return date.toLocaleString();
        }
        

        // Fetch the latest image based on the prefix and category
        async function fetchImagesByCategory() {
            const repoUrl = 'https://api.github.com/repos/PressureSole/srdesign/contents/images';
            try {
                const response = await fetch(repoUrl);
                if (!response.ok) {
                    console.error('Failed to fetch images.');
                    return;
                }
                const files = await response.json();

                // First, categorize images into symmetry and fatigue
                const symmetryImages = files.filter(file => file.name.includes('symmetry'));
                const fatigueImages = files.filter(file => file.name.includes('fatigue'));

                // Then, sort the images chronologically within each category by the timestamp
                const sortedSymmetryImages = sortImagesByTimestamp(symmetryImages);
                const sortedFatigueImages = sortImagesByTimestamp(fatigueImages);

                // Separate into section and gradient categories for each image group
                const symmetrySectionImages = filterImagesByType(sortedSymmetryImages, 'section');
                const symmetryGradientImages = filterImagesByType(sortedSymmetryImages, 'gradient');
                const fatigueSectionImages = filterImagesByType(sortedFatigueImages, 'section');
                const fatigueGradientImages = filterImagesByType(sortedFatigueImages, 'gradient');

                // Insert images into the correct sections (Section View)
                insertImagesIntoSection(symmetrySectionImages, 'symmetry-images');
                insertImagesIntoSection(fatigueSectionImages, 'fatigue-images');

                // Insert images into the correct sections (Gradient View)
                insertImagesIntoSection(symmetryGradientImages, 'symmetry-gradient-images');
                insertImagesIntoSection(fatigueGradientImages, 'fatigue-gradient-images');

            } catch (error) {
                console.error('Error fetching images:', error);
            }
        }

        // Helper function to sort images by timestamp extracted from the filename
        function sortImagesByTimestamp(images) {
            return images.sort((a, b) => {
                // Extract timestamp from filename (e.g., 'fatigue1_gradient_20250323204223.png')
                const timestampA = a.name.match(/(\d{14})/);
                const timestampB = b.name.match(/(\d{14})/);
                if (timestampA && timestampB) {
                    return timestampA[1] < timestampB[1] ? -1 : 1;
                }
                return 0;
            });
        }

        // Helper function to filter images by type (section or gradient)
        function filterImagesByType(images, type) {
            return images.filter(image => image.name.includes(type));
        }

        // Helper function to insert images into the correct section
        function insertImagesIntoSection(images, sectionId) {
            const section = document.getElementById(sectionId);
            if (!section) {
                console.error('Section with ID ' + sectionId + ' not found.');
                return;
            }
            section.innerHTML = '';  // Clear existing images
            images.forEach(image => {
                const imgElement = document.createElement('img');
                imgElement.src = `https://raw.githubusercontent.com/PressureSole/srdesign/main/${image.path}`;
                imgElement.alt = image.name;
                imgElement.style = 'max-width: 100%; height: auto; border-radius: 8px;';
                section.appendChild(imgElement);

                // Optionally display the timestamp next to the image
                const timestamp = image.name.match(/(\d{14})/);
                if (timestamp) {
                    const timestampElement = document.createElement('p');
                    timestampElement.textContent = "Timestamp: " + formatTimestamp(timestamp[0]);
                    timestampElement.style = 'color: #333;';
                    section.appendChild(timestampElement);
                } else {
                    const timestampElement = document.createElement('p');
                    timestampElement.textContent = "Timestamp: Not available";
                    timestampElement.style = 'color: red;';
                    section.appendChild(timestampElement);
                }
            });
        }

        // Toggle between section and gradient views
        function switchView() {
            const staticView = document.getElementById('section-view');
            const dynamicView = document.getElementById('gradient-view');
            const button = document.getElementById('switch-view-btn');

            if (staticView.style.display === "none") {
                staticView.style.display = "block";
                dynamicView.style.display = "none";
                button.innerHTML = "Switch to Gradient View";
            } else {
                staticView.style.display = "none";
                dynamicView.style.display = "block";
                button.innerHTML = "Switch to Section View";
            }

            // Update images based on the view type after toggle
            updateImagesForView();
        }

        // Update images based on the active view (section or gradient)
        function updateImagesForView() {
            const sectionImages = document.querySelectorAll('.section-img');
            const gradientImages = document.querySelectorAll('.gradient-img');

            const isSectionView = document.getElementById('section-view').style.display === "block";

            // Show only section images when in section view
            sectionImages.forEach(img => {
                img.style.display = isSectionView ? 'block' : 'none';
            });

            // Show only gradient images when in gradient view
            gradientImages.forEach(img => {
                img.style.display = !isSectionView ? 'block' : 'none';
            });
        }

        // Load images when the page loads
        window.onload = fetchImagesByCategory;
    </script>
</div>



<!-- GAIT MECH tab ------------------------------------------------------------------- -->
<div id="gait-mechanics" class="content">    
    <h1>Gait Mechanics</h1>
    
    <!-- Cadence Section -->
    <section id="cadence">
        <h2>Cadence</h2>
        <button onclick="toggleDetails('cadence-details')">Details</button>
        <p id="cadence-details" class="details" style="display:none;">
            The number of steps taken per unit of time, expressed in steps per minute. A good running cadence typically falls around 170-180 steps per minute (SPM) for most runners. A cadence lower than 160 SPM often indicates overstriding, which can increase impact forces and elevate the risk of injuries such as shin splints or knee pain. Conversely, a cadence significantly higher than 190 SPM may suggest a short, inefficient stride that can lead to excessive muscular fatigue. To improve cadence, runners can focus on strength training, especially targeting the core, glutes, and hip flexors to improve stability and control. Incorporating dynamic stretching and mobility work can help improve flexibility and range of motion, allowing for a more efficient stride. Doing short intervals at a higher cadence can also help runners safely reach and maintain an optimal cadence.
        </p>
        <div class="graph-container">
            <!-- Insert graph here -->
        </div>
    </section>
    
    <!-- Ground Contact Time Section -->
    <section id="stance-time">
        <h2>Stance Time</h2>
        <button onclick="toggleDetails('stance-details')">Details</button>
        <p id="stance-details" class="details" style="display:none;">
            The duration for which a foot remains in contact with the ground during a gait cycle. Stance time, the amount of time a foot stays in contact with the ground during running, is typically around 200-300 milliseconds for most runners. A longer stance time (above 300 ms) often indicates inefficient mechanics, such as overstriding or weak push-off, which can increase the risk of injuries like plantar fasciitis or Achilles tendinopathy. On the other hand, a very short stance time (below 200 ms) may suggest insufficient shock absorption, leading to increased stress on the joints and muscles. To improve stance time, runners can work on strength training, particularly focusing on the glutes, calves, and hamstrings to generate a stronger, more efficient push-off. Incorporating plyometric exercises and single-leg balance drills can enhance foot strength and neuromuscular coordination. Additionally, practicing running drills that promote a quick, light foot strike, such as high knees and quick cadence strides, can help reduce stance time and improve running efficiency.
        </p>
        <div class="graph-container">
            <!-- Insert graph here -->
        </div>
    </section>
    
    <!-- Supination/Pronation Section -->
    <section id="supination/pronation">
        <h2>Supination/Pronation</h2>
        <button onclick="toggleDetails('supination-details')">Details</button>
        <p id="supination-details" class="details" style="display:none;">
            If you see the center of pressure dot drift towards the inside of the foot, this is indicative of possible pronation. 
            If you see the center of pressure dot drift towards the outside of the foot, this is indicative of possible supination.
            overpronation (excessive inward rolling) can lead to issues like plantar fasciitis, shin splints, and knee pain due to poor shock absorption and misalignment. Supination (or underpronation) is when the foot rolls outward, placing excessive stress on the outer edge of the foot and increasing the risk of ankle sprains, stress fractures, and IT band syndrome. To address overpronation, runners can benefit from stability or motion-control shoes, along with strengthening the arch, hips, and glutes to improve alignment and control. For supination, using cushioned, neutral shoes and incorporating mobility work to increase ankle flexibility can help. Strengthening the calves, ankles, and intrinsic foot muscles can also promote better foot mechanics and reduce the risk of injury. 
        </p>
        <div class="graph-container">
            <!-- Insert graph here -->
        </div>
    </section>
</div>

<style>
    .graph-container {
        width: 100%;
        height: 200px; /* Adjust as needed */
        background-color: #f0f0f0; /* Placeholder background */
        margin: 10px 0;
    }
    
    button {
        margin-top: 5px;
        padding: 5px 10px;
        font-size: 14px;
        cursor: pointer;
        background-color: #007BFF;
        color: white;
        border: none;
        border-radius: 5px;
    }

    button:hover {
        background-color: #0056b3;
    }

    .details {
        margin-top: 10px;
        background-color: #f9f9f9;
        padding: 8px;
        border-left: 4px solid #007BFF;
        border-radius: 4px;
    }
</style>

<script>
    function toggleDetails(id) {
        var element = document.getElementById(id);
        if (element.style.display === "none") {
            element.style.display = "block";
        } else {
            element.style.display = "none";
        }
    }
</script>
    <!-- SCORES tab ------------------------------------------------------------- -->
    <div id="scores" class="content">
        <h1>Scores</h1>
        
        <div class="scores-container">
            <!-- Stress Score -->
            <div class="score-item">
                <div class="score-circle stress" data-color="green"> <!-- Added the "stress" class -->
                    <div class="label">Stress</div>
                    <div class="circle-content">
                        <svg width="200" height="200" viewBox="0 0 100 100">
                            <!-- Background Circle -->
                            <circle cx="50" cy="50" r="40" fill="none" stroke="#ddd" stroke-width="10" />
                            
                            <!-- Wrap the foreground circle in a group with an inline transform -->
                            <g transform="rotate(-90,50,50)">
                                <circle class="foreground" cx="50" cy="50" r="40" fill="none" stroke="green" stroke-width="10"
                                    stroke-dasharray="251.2" stroke-dashoffset="251.2" stroke-linecap="round" />
                            </g>
                        </svg>
                        <div class="number">0</div>
                        <!-- <div class="number">6</div> -->
                    </div>
                </div>
                <!-- Details button and box -->
                <button class="details-btn">Details</button>
                <div class="details-box"></div>
            </div>
            

            <!-- Symmetry Score -->
            <div class="score-item">
                <div class="score-circle symmetry" data-color="green"> <!-- Added the "symmetry" class -->
                    <div class="label">Symmetry</div>
                    <div class="circle-content">
                        <svg width="200" height="200" viewBox="0 0 100 100">
                            <!-- Background Circle -->
                            <circle cx="50" cy="50" r="40" fill="none" stroke="#ddd" stroke-width="10" />
                            
                            <!-- Wrap the foreground circle in a group with an inline transform -->
                            <g transform="rotate(-90,50,50)">
                                <circle class="foreground" cx="50" cy="50" r="40" fill="none" stroke="green" stroke-width="10"
                                    stroke-dasharray="251.2" stroke-dashoffset="251.2" stroke-linecap="round" />
                            </g>
                        </svg>
                        <div class="number">0</div>
                        <!-- <div class="number">85</div> -->
                    </div>
                </div>
                <!-- Details button and box -->
                <button class="details-btn">Details</button>
                <div class="details-box"></div>
            </div>

            <!-- Fatigue (Left) Score -->
            <div class="score-item">
                <div class="score-circle fatigue-left" data-color="green">
                    <div class="label">Fatigue (Left)</div>
                    <div class="circle-content">
                        <svg width="200" height="200" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="40" fill="none" stroke="#ddd" stroke-width="10" />
                            <g transform="rotate(-90,50,50)">
                                <circle class="foreground" cx="50" cy="50" r="40" fill="none" stroke="green" stroke-width="10"
                                        stroke-dasharray="251.2" stroke-dashoffset="251.2" stroke-linecap="round" />
                            </g>
                        </svg>
                        <div class="number">0</div>
                    </div>
                </div>
                <button class="details-btn">Details</button>
                <div class="details-box"></div>
            </div>
            
            <!-- Fatigue (Right) Score -->
            <div class="score-item">
                <div class="score-circle fatigue-right" data-color="green">
                    <div class="label">Fatigue (Right)</div>
                    <div class="circle-content">
                        <svg width="200" height="200" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="40" fill="none" stroke="#ddd" stroke-width="10" />
                            <g transform="rotate(-90,50,50)">
                                <circle class="foreground" cx="50" cy="50" r="40" fill="none" stroke="green" stroke-width="10"
                                        stroke-dasharray="251.2" stroke-dashoffset="251.2" stroke-linecap="round" />
                            </g>
                        </svg>
                        <div class="number">0</div>
                    </div>
                </div>
                <button class="details-btn">Details</button>
                <div class="details-box"></div>
            </div>
        </div>
    </div>

    <!-- Profile tab -->
    <!-- <div id="profile" class="content">    
        <div class="profile-container">
            <h1>Profile</h1>
            <p>Manage your user profile and personal information.</p>
            <form id="profile-form" class="profile-form"> -->
                <!-- New Username Field -->
                <!-- <div class="form-row">
                    <div class="form-group">
                        <label for="username">Username:</label>
                        <input type="text" id="username" name="username">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="first-name">First Name:</label>
                        <input type="text" id="first-name" name="firstName">
                    </div>
                    <div class="form-group">
                        <label for="last-name">Last Name:</label>
                        <input type="text" id="last-name" name="lastName">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="weight">Weight (lbs):</label>
                        <input type="number" id="weight" name="weight">
                    </div>
                    <div class="form-group">
                        <label for="gender">Gender:</label>
                        <select id="gender" name="gender">
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <button type="submit">Save Profile</button>
            </form> -->

            <!-- Temporary measure to view all saved profiles -->
            <!-- <button id="show-profiles-btn" onclick="showProfiles()">Show All Profiles</button>
            <button id="clear-profiles-btn" onclick="clearProfiles()">Clear Profiles</button>
            <div id="profiles-output" style="margin-top:20px; background:#f7f7f7; padding:10px; border:1px solid #ccc;"></div>
            
        </div>
    </div> -->

    <!-- Profile tab NEW -------------------------------------------------------- -->
    <div id="profile" class="content">
        <!-- Sign Up and Log In Container -->
        <div id="signup-login-container" style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
            <!-- Sign Up Box -->
            <div class="signup-box" style="flex: 1; max-width: 500px; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
                <h1>Sign Up</h1>
                <form id="signup-form" class="profile-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="signup-username">Username:</label>
                            <input type="text" id="signup-username" name="username">
                        </div>
                    </div>
                    <div class="form-row" style="position: relative;">
                        <div class="form-group" style="width: 100%;">
                          <label for="signup-password">Password:</label>
                          <input type="password" id="signup-password" name="password">
                          <!-- Eye icon for toggling password visibility in Sign Up form -->
                          <i id="signup-toggle-password" class="fas fa-eye" style="position: absolute; top: 35px; right: 10px; cursor: pointer;"></i>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="first-name">First Name:</label>
                            <input type="text" id="first-name" name="firstName">
                        </div>
                        <div class="form-group">
                            <label for="last-name">Last Name:</label>
                            <input type="text" id="last-name" name="lastName">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="weight">Weight (lbs):</label>
                            <input type="number" id="weight" name="weight">
                        </div>
                        <div class="form-group">
                            <label for="gender">Gender:</label>
                            <select id="gender" name="gender">
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit">Sign up</button>
                </form>
            </div>
            
            <!-- Log In Box -->
            <div class="login-box" style="flex: 1; max-width: 500px; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
                <h1>Log In</h1>
                <form id="login-form" class="profile-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="login-username">Username:</label>
                            <input type="text" id="login-username" name="username">
                        </div>
                    </div>
                    <div class="form-row" style="position: relative;">
                        <div class="form-group" style="width: 100%;">
                          <label for="login-password">Password:</label>
                          <input type="password" id="login-password" name="password">
                          <!-- Eye icon for toggling password visibility in Log In form -->
                          <i id="login-toggle-password" class="fas fa-eye" style="position: absolute; top: 35px; right: 10px; cursor: pointer;"></i>
                        </div>
                    </div>
                    <button type="submit">Log In</button>
                </form>
            </div>
        </div>
        
        <!-- Your Profile container -->
        <div id="your-profile" class="profile-container" style="max-width: 500px; margin: auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); display: none;">
            <h1>Your Profile</h1>
            <form id="profile-view-form" class="profile-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="display-username">Username:</label>
                        <input type="text" id="display-username" name="username" readonly style="background-color: #eaeaea;">
                    </div>
                </div>
                <div class="form-row" style="position: relative;">
                    <div class="form-group" style="width: 100%;">
                      <label for="display-password">Password:</label>
                      <input type="password" id="display-password" name="password" readonly style="background-color: #eaeaea; padding-right: 40px;">
                      <!-- Eye icon for toggling password visibility in the Your Profile form -->
                      <i id="profile-toggle-password" class="fas fa-eye" style="position: absolute; top: 35px; right: 10px; cursor: pointer; display: none;"></i>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="display-first-name">First Name:</label>
                        <input type="text" id="display-first-name" name="firstName" readonly style="background-color: #eaeaea;">
                    </div>
                    <div class="form-group">
                        <label for="display-last-name">Last Name:</label>
                        <input type="text" id="display-last-name" name="lastName" readonly style="background-color: #eaeaea;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="display-weight">Weight (lbs):</label>
                        <input type="number" id="display-weight" name="weight" readonly style="background-color: #eaeaea;">
                    </div>
                    <div class="form-group">
                        <label for="display-gender">Gender:</label>
                        <select id="display-gender" name="gender" disabled style="background-color: #eaeaea;">
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <button type="button" id="edit-profile-btn" style="width: calc(100% - 10px); padding: 10px; background-color: #ff5500; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; margin-top: 20px;">Edit Profile</button>
            </form>

            <!-- New Log Out button -->
            <button type="button" id="logout-btn" style="width: 150px; padding: 10px; background-color: grey; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; margin-top: 20px;">Log Out</button>
            
            <!-- Show Profiles and Clear Profiles Buttons -->
            <div style="margin-top: 20px; text-align: center;">
                <button id="show-profiles-btn" onclick="showProfiles()" style="padding: 10px 20px; background-color: #2a9d8f; color: white; border: none; border-radius: 5px; cursor: pointer;">Show All Profiles</button>
                <button id="clear-profiles-btn" onclick="clearProfiles()" style="padding: 10px 20px; background-color: #e76f51; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">Clear Profiles</button>
            </div>
            <div id="profiles-output" style="margin-top: 20px; background: #f7f7f7; padding: 10px; border: 1px solid #ccc;"></div>
        </div>

        <!-- Run History container -->
        <div class="run-history-container" style="display: none; max-width: 1000px; margin: 20px auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
            <h1 style="text-align: center; margin-bottom: 20px;">Run History</h1>
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background-color: #f4f4f4;">
                  <th style="padding: 10px; text-align: left;">Date</th>
                  <th style="padding: 10px; text-align: left;">Distance</th>
                  <th style="padding: 10px; text-align: left;">Stress</th>
                  <th style="padding: 10px; text-align: left;">Symmetry</th>
                  <th style="padding: 10px; text-align: left;">Fatigue</th>
                </tr>
              </thead>
              <tbody>
                <!-- For now, there is only one run row -->
                <tr>
                  <td style="padding: 10px;">--</td>
                  <td style="padding: 10px;">--</td>
                  <td id="run-stress" style="padding: 10px;">--</td>
                  <td id="run-symmetry" style="padding: 10px;">--</td>
                  <td id="run-fatigue" style="padding: 10px;">--</td>
                </tr>
              </tbody>
            </table>
        </div>
    </div>

    <!-- FAQs tab --------------------------------------------------------------------- -->
    <div id="faqs" class="content">
        <h1>Frequently Asked Questions</h1>
        <div class="faqs-container" style="padding: 20px;">
            <!-- <h1 style="text-align: center; margin-bottom: 20px;">Frequently Asked Questions</h1> -->
            <div class="faq-columns">
                <div class="faq-column-left">
                    <div class="faq-box">
                        <h3>What is PressureSole and how does it help runners?</h3>
                        <div class="faq-answer">PressureSole is a low-cost insole with embedded sensors that provides feedback on your running form. It helps reduce the risk of running-related injuries by giving real-time insights into stress, fatigue, and symmetry during your runs.</div>
                    </div>
                    <div class="faq-box">
                        <h3>How does PressureSole calculate my Stress, Fatigue, and Symmetry scores?</h3>
                        <div class="faq-answer">The system analyzes pressure values collected from 11 sensors placed across the insole and PressureSole’s models process this data to provide:<br>
                            Stress: Overall loading and intensity on your feet.<br>
                            Fatigue: Signs of declining performance (force output, step rate, contact time).<br>
                            Symmetry: The balance between your left and right foot pressures. </div>
                    </div>
                    <div class="faq-box">
                        <h3>Why did you choose to use 11 sensors instead of more?</h3>
                        <div class="faq-answer">Through extensive research, we found that 11 strategically placed sensors provide a strong balance between accuracy and cost reduction. This keeps the product affordable without sacrificing meaningful data.</div>
                    </div>
                </div>
                <div class="faq-column-right">
                    <div class="faq-box">
                        <h3>How accurate is PressureSole compared to professional devices?</h3>
                        <div class="faq-answer">PressureSole achieves approximately 80% accuracy when compared to industry-standard devices like the Loadsol, which is sufficient for amateur runners to receive actionable feedback at a much lower cost.</div>
                    </div>
                    <div class="faq-box">
                        <h3>Is PressureSole only for runners or can others use it? </h3>
                        <div class="faq-answer">While the primary focus is on amateur runners, PressureSole can be useful for anyone looking to recieve feedback on their risk for injury, including athletes in other sports or individuals undergoing physical therapy.</div>
                    </div>
                    <div class="faq-box">
                        <h3>How is data transmitted from the insole to the web app? </h3>
                        <div class="faq-answer">Pressure data is collected via the embedded sensors and transmitted wirelessly to the web app through a Bluetooth-enabled PCB, where it is processed and displayed in real time.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPT / FUNCTIONS ----------------------------------------------------------------- -->
    <script>
        // Nav Bar Tab 
        function showPage(pageId) {
            console.log("Switching to page: " + pageId);  // Debugging log
            // Hide all pages
            var pages = document.querySelectorAll('.content');
            pages.forEach(page => page.classList.remove('active'));
            
            // Show the selected page
            var pageToShow = document.getElementById(pageId);
            if (pageToShow) {
                pageToShow.classList.add('active');
            } else {
                console.error("No page found with id:", pageId);
            }
        }

        // HOME Page -----------------------------------------------------------------------
        function updateHomeRunStats() {
            // Get the stat items from the home page.
            const homeStress = document.getElementById('home-stress');
            const homeSymmetry = document.getElementById('home-symmetry');
            const homeFatigueLeft = document.getElementById('home-fatigue-left');
            const homeFatigueRight = document.getElementById('home-fatigue-right');

            // Helper functions for color logic:
            function getColorForLowerBetter(score) {
                if (score <= 29) {
                    return 'green';
                } else if (score <= 69) {
                    return 'yellow';
                } else {
                    return 'red';
                }
            }
            function getColorForHigherBetter(score) {
                if (score >= 70) {
                    return 'green';
                } else if (score >= 30) {
                    return 'yellow';
                } else {
                    return 'red';
                }
            }

            // Extract the scores from your scoreValues array.
            // In your code, scoreValues is defined as [stressScore, symmetryScore, fatigueScore].
            // Since you want the order Stress, Fatigue, Symmetry on the home page, note the difference.
            const stressScore = scoreValues[0];
            const symmetryScore = scoreValues[1];
            const fatigueLeft = scoreValues[2];
            const fatigueRight = scoreValues[3];

            // Update the home page items:
            // For stress and fatigue, lower is better.
            homeStress.querySelector('span').textContent = stressScore;
            homeStress.querySelector('span').style.color = getColorForLowerBetter(stressScore);

            homeFatigueLeft.querySelector('span').textContent = fatigueLeft;
            homeFatigueLeft.querySelector('span').style.color = getColorForLowerBetter(fatigueLeft);

            homeFatigueRight.querySelector('span').textContent = fatigueRight;
            homeFatigueRight.querySelector('span').style.color = getColorForLowerBetter(fatigueRight);

            // For symmetry, higher is better.
            homeSymmetry.querySelector('span').textContent = symmetryScore;
            homeSymmetry.querySelector('span').style.color = getColorForHigherBetter(symmetryScore);

            homeStress.querySelector('span').style.textShadow = "1px 1px 2px rgba(0,0,0,0.5)";
            homeSymmetry.querySelector('span').style.textShadow = "1px 1px 2px rgba(0,0,0,0.5)";
            homeFatigueLeft.querySelector('span').style.textShadow = "1px 1px 2px rgba(0,0,0,0.5)";
            homeFatigueRight.querySelector('span').style.textShadow = "1px 1px 2px rgba(0,0,0,0.5)";
        }


        // SCORES Page ---------------------------------------------------------------------

        // Define score variables (temporary default values)
        // Temporary default test values
        let stressScore = 10;
        let symmetryScore = 8;
        let fatigueLeft = 42;
        let fatigueRight = 50;
        
        // Array of scores in order: Stress, Symmetry, Fatigue
        let scoreValues = [stressScore, symmetryScore, fatigueLeft, fatigueRight];

        function updateScoreCircles() {
            const circles = document.querySelectorAll('.score-circle');
            const perimeter = 251.2; // Circumference for a circle with r = 40

            circles.forEach((circle, index) => {
                let score = scoreValues[index];
                const bar = circle.querySelector('svg circle.foreground');
                if (!bar) {
                    console.error("Foreground circle not found");
                    return;
                }
                
                // Set the dasharray and dashoffset so the arc length represents the score percentage
                bar.setAttribute('stroke-dasharray', perimeter);
                bar.setAttribute('stroke-dashoffset', perimeter - (score / 100 * perimeter));

                // Determine the stroke color based on score and category.
                let color;
                if (circle.classList.contains('symmetry')) {
                    // For symmetry, higher is better.
                    if (score >= 70) {
                        color = 'green';
                    } else if (score >= 30) {
                        color = 'yellow';
                    } else {
                        color = 'red';
                    }
                } else {
                    // For stress and fatigue, lower is better.
                    if (score <= 29) {
                        color = 'green';
                    } else if (score <= 69) {
                        color = 'yellow';
                    } else {
                        color = 'red';
                    }
                }
                bar.style.stroke = color;

                // Set a data attribute for the score color for later use in the details box.
                circle.setAttribute('data-color', color);

                // Update the displayed number in the center.
                const numberEl = circle.querySelector('.number');
                if (numberEl) {
                    numberEl.textContent = score;
                }
            });
        }
        
        // DETAILS BUTTON

        // Mapping of detailed responses for each category and color
        const responses = {
            stress: {
                green: "Great job! Your stress levels are low, meaning the impact on your feet is well-distributed and not excessive. This suggests that your running form and footwear are effectively managing ground forces, reducing the risk of overuse injuries. Keep up the good work, and continue practicing proper foot strike and posture to maintain this balance!",
                yellow: "Your stress levels are moderate, indicating that some areas of your feet may be experiencing increased pressure during your run. This could be due to factors such as uneven weight distribution, fatigue, or slight inefficiencies in form. Consider checking your footwear, focusing on even foot strikes, and incorporating strength or mobility exercises to improve impact absorption.",
                red: "High stress levels detected! This means that certain areas of your feet are absorbing excessive impact, which could increase the risk of discomfort or injury over time. Possible causes include improper form, worn-out shoes, or excessive training intensity. You may want to reassess your footwear, adjust your stride mechanics, or incorporate recovery strategies to reduce strain on your feet."
            },
            symmetry: {
                green: "Excellent symmetry! Your left and right sides are well-balanced, meaning your foot strike and weight distribution are even. This helps improve efficiency, reduce strain on one side of your body, and lower the risk of compensatory injuries. Keep maintaining strong biomechanics and balanced strength training to preserve this symmetry!",
                yellow: "Your symmetry score suggests some imbalance between your left and right sides. This could be due to muscle imbalances, fatigue, or slight inefficiencies in your stride. While not a major concern yet, it’s worth paying attention to any discomfort or overuse on one side. Strengthening weaker muscles, focusing on even foot strikes, and incorporating single-leg exercises may help improve your balance over time.",
                red: "Significant asymmetry detected! A major imbalance in your running form could lead to uneven stress on your joints and muscles, increasing the risk of injury. Possible causes include past injuries, muscle weaknesses, or poor movement patterns. Consider consulting a specialist or incorporating targeted strength and mobility work to correct imbalances and enhance your running efficiency."
            },
            fatigueLeft: {
                green: "Your fatigue levels are low, meaning your feet are handling the demands of your run well. This suggests that your muscles and biomechanics are efficiently managing workload without excessive strain. Keep up your current training routine and recovery practices to maintain endurance and prevent overuse injuries.",
                yellow: "Moderate fatigue detected. This means your feet are starting to show signs of stress, which could lead to decreased efficiency and increased risk of discomfort over longer distances. Consider incorporating proper warm-ups, strength training, and post-run recovery techniques like stretching or massage to help manage fatigue and sustain performance.",
                red: "High fatigue levels detected! Your feet are likely experiencing significant strain, which could negatively impact your running form and increase injury risk. This may be due to overtraining, insufficient recovery, or inefficient biomechanics. It’s a good idea to assess your training load, prioritize rest, and focus on strengthening your feet and lower legs to improve endurance and reduce strain over time."
            },
            fatigueRight: {
                green: "Your fatigue levels are low, meaning your feet are handling the demands of your run well. This suggests that your muscles and biomechanics are efficiently managing workload without excessive strain. Keep up your current training routine and recovery practices to maintain endurance and prevent overuse injuries.",
                yellow: "Moderate fatigue detected. This means your feet are starting to show signs of stress, which could lead to decreased efficiency and increased risk of discomfort over longer distances. Consider incorporating proper warm-ups, strength training, and post-run recovery techniques like stretching or massage to help manage fatigue and sustain performance.",
                red: "High fatigue levels detected! Your feet are likely experiencing significant strain, which could negatively impact your running form and increase injury risk. This may be due to overtraining, insufficient recovery, or inefficient biomechanics. It’s a good idea to assess your training load, prioritize rest, and focus on strengthening your feet and lower legs to improve endurance and reduce strain over time."
            }
        };

        document.querySelectorAll('.details-btn').forEach(button => {
            button.addEventListener('click', function() {
                // Get the parent container (.score-item)
                const container = this.closest('.score-item');
                const detailsBox = container.querySelector('.details-box');
                const scoreCircle = container.querySelector('.score-circle');
                const scoreColor = scoreCircle.getAttribute('data-color');
                
                // Determine category based on score-circle's classes
                let category = "";
                if (scoreCircle.classList.contains('stress')) {
                    category = "stress";
                } else if (scoreCircle.classList.contains('symmetry')) {
                    category = "symmetry";
                } else if (scoreCircle.classList.contains('fatigue-left')) {
                    category = "fatigueLeft";
                } else if (scoreCircle.classList.contains('fatigue-right')) {
                    category = "fatigueRight";
                }
                
                // Toggle the details box visibility and update button text
                if (detailsBox.style.display === 'none' || detailsBox.style.display === '') {
                    // Show details and update the button label to "Close ^"
                    detailsBox.textContent = responses[category][scoreColor];
                    detailsBox.style.display = 'block';
                    this.textContent = "Close";
                } else {
                    // Hide details and revert button text to "Details"
                    detailsBox.style.display = 'none';
                    this.textContent = "Details";
                }
            });
        });

        // TEMPORARY function to prompt for new SCORES
        function testScoreInput() {
            let newStress = prompt("Enter Stress score (0-100):", stressScore);
            let newSymmetry = prompt("Enter Symmetry score (0-100):", symmetryScore);
            let newFatigueLeft = prompt("Enter Fatigue (Left) score (0-100):", fatigueLeft);
            let newFatigueRight = prompt("Enter Fatigue score (Right) (0-100):", fatigueRight);
            scoreValues = [Number(newStress), Number(newSymmetry), Number(newFatigueLeft), Number(newFatigueRight)];
            
            // Store the run scores in localStorage so they persist.
            localStorage.setItem('runScores', JSON.stringify(scoreValues));

            updateScoreCircles();
            updateHomeRunStats(); // Update the home page "Your Last Run" box
            updateRunHistory();   // Update the Run History table with new scores
        }

        // Initial update
        //updateScoreCircles();
        //testScoreInput();

        // PROFILE Page ---------------------------------

        // Reusable function to attach a toggle event listener to a password field
        function setupTogglePassword(inputID, iconID) {
            const inputField = document.getElementById(inputID);
            const icon = document.getElementById(iconID);
            icon.addEventListener('click', function() {
                if (inputField.type === "password") {
                inputField.type = "text";
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
                } else {
                inputField.type = "password";
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Attach toggle for Sign Up form
            setupTogglePassword('signup-password', 'signup-toggle-password');
            // Attach toggle for Log In form
            setupTogglePassword('login-password', 'login-toggle-password');
            // Attach toggle for Your Profile form (it remains attached even if hidden initially)
            setupTogglePassword('display-password', 'profile-toggle-password');

            // For Sign Up password field:
            document.getElementById('signup-password').addEventListener('input', function() {
                const icon = document.getElementById('signup-toggle-password');
                if (this.value.length > 0) {
                    icon.style.display = "inline-block";
                } else {
                    icon.style.display = "none";
                }
            });

            // For Log In password field:
            document.getElementById('login-password').addEventListener('input', function() {
                const icon = document.getElementById('login-toggle-password');
                if (this.value.length > 0) {
                    icon.style.display = "inline-block";
                } else {
                    icon.style.display = "none";
                }
            });

            // For Your Profile password field:
            //document.getElementById('display-password').addEventListener('input', function() {
            //    const icon = document.getElementById('profile-toggle-password');
                // In the profile form, we want the toggle icon to be visible only during editing
                // So if the field is in edit mode (i.e. not readonly) and has text, show the icon.
            //    if (this.value.length > 0 && !this.hasAttribute('readonly')) {
            //        icon.style.display = "inline-block";
            //    } else {
            //        icon.style.display = "none";
            //    }
            //});

            // Log In functionality
            document.getElementById('login-form').addEventListener('submit', function(event) {
                event.preventDefault();
                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value.trim();
                const storedProfile = localStorage.getItem('profile_' + username);
                if (!storedProfile) {
                alert("No profile found for this username.");
                return;
                }
                const profileData = JSON.parse(storedProfile);
                if (profileData.password !== password) {
                alert("Incorrect password.");
                return;
                }
                document.getElementById('signup-login-container').style.display = 'none';
                document.getElementById('display-username').value = profileData.username;
                document.getElementById('display-password').value = profileData.password;
                document.getElementById('display-first-name').value = profileData.firstName;
                document.getElementById('display-last-name').value = profileData.lastName;
                document.getElementById('display-weight').value = profileData.weight;
                document.getElementById('display-gender').value = profileData.gender;
                document.getElementById('your-profile').style.display = 'block';

                // **NEW LINE: Update the Run History with the stored test scores**
                updateRunHistory();
            });
            
            // Sign Up functionality
            document.getElementById('signup-form').addEventListener('submit', function(event) {
                event.preventDefault();
                const username = document.getElementById('signup-username').value.trim();
                const password = document.getElementById('signup-password').value.trim();
                const firstName = document.getElementById('first-name').value.trim();
                const lastName = document.getElementById('last-name').value.trim();
                const weight = document.getElementById('weight').value.trim();
                const gender = document.getElementById('gender').value.trim();
                if (!username || !password || !firstName || !lastName || !weight || !gender) {
                alert("Please fill out all fields.");
                return;
                }
                if (localStorage.getItem('profile_' + username)) {
                alert("This username already exists. Please choose a different username or log in.");
                return;
                }
                const profileData = {
                username: username,
                password: password,
                firstName: firstName,
                lastName: lastName,
                weight: weight,
                gender: gender
                };
                localStorage.setItem('profile_' + username, JSON.stringify(profileData));
                document.getElementById('signup-login-container').style.display = 'none';
                document.getElementById('display-username').value = username;
                document.getElementById('display-password').value = password;
                document.getElementById('display-first-name').value = firstName;
                document.getElementById('display-last-name').value = lastName;
                document.getElementById('display-weight').value = weight;
                document.getElementById('display-gender').value = gender;
                document.getElementById('your-profile').style.display = 'block';
            });
            
            // Toggle between Edit and Save Profile modes on the "Your Profile" page
            document.getElementById('edit-profile-btn').addEventListener('click', function() {
                const usernameInput = document.getElementById('display-username');
                const passwordInput = document.getElementById('display-password');
                const firstNameInput = document.getElementById('display-first-name');
                const lastNameInput = document.getElementById('display-last-name');
                const weightInput = document.getElementById('display-weight');
                const genderSelect = document.getElementById('display-gender');
                const profileToggleIcon = document.getElementById('profile-toggle-password');

                if (this.innerText === "Edit Profile") {
                    // Switch to edit mode
                    usernameInput.removeAttribute('readonly');
                    passwordInput.removeAttribute('readonly');
                    firstNameInput.removeAttribute('readonly');
                    lastNameInput.removeAttribute('readonly');
                    weightInput.removeAttribute('readonly');
                    genderSelect.disabled = false;

                    // Force the eye icon to show so the user can toggle password visibility
                    profileToggleIcon.style.display = "inline-block";
                    profileToggleIcon.style.zIndex = "100";

                    this.innerText = "Save Profile";
                } else {
                    // Validate and save the profile data
                    const username = usernameInput.value.trim();
                    const password = passwordInput.value.trim();
                    const firstName = firstNameInput.value.trim();
                    const lastName = lastNameInput.value.trim();
                    const weight = weightInput.value.trim();
                    const gender = genderSelect.value;
                    if (!username || !password || !firstName || !lastName || !weight || !gender) {
                        alert("Please fill out all fields before saving.");
                        return;
                    }
                    const profileData = {
                        username: username,
                        password: password,
                        firstName: firstName,
                        lastName: lastName,
                        weight: weight,
                        gender: gender
                    };
                    localStorage.setItem('profile_' + username, JSON.stringify(profileData));

                    // Switch back to read-only mode
                    usernameInput.setAttribute('readonly', true);
                    passwordInput.setAttribute('readonly', true);
                    firstNameInput.setAttribute('readonly', true);
                    lastNameInput.setAttribute('readonly', true);
                    weightInput.setAttribute('readonly', true);
                    genderSelect.disabled = true;

                    passwordInput.type = "password";
                    
                    // Hide the toggle icon now that editing is finished
                    profileToggleIcon.style.display = "none";

                    this.innerText = "Edit Profile";
                    alert("Profile saved successfully!");
                }
            });
            // Add event listener for the Log Out button
            document.getElementById('logout-btn').addEventListener('click', function() {
                // Hide the profile view container
                document.getElementById('your-profile').style.display = 'none';
                // Show the sign up / log in container (assuming its id is "signup-login-container")
                document.getElementById('signup-login-container').style.display = 'flex';

                // Clear the sign up form
                document.getElementById('signup-form').reset();
                // Clear the log in form
                document.getElementById('login-form').reset();
            });
            function updateRunHistory() {
                // Assuming scoreValues is defined as: [stressScore, symmetryScore, fatigueScore]
                const stressVal = scoreValues[0];
                const symmetryVal = scoreValues[1];
                const fatigueVal = scoreValues[2];
                
                document.getElementById('run-stress').innerText = stressVal;
                document.getElementById('run-symmetry').innerText = symmetryVal;
                document.getElementById('run-fatigue').innerText = fatigueVal;
            }

            testScoreInput();

            // Check if run scores are already stored
            //const storedRunScores = localStorage.getItem('runScores');
            //if (!storedRunScores || storedRunScores === '[]') {
            //testScoreInput();
            //} else {
            //    scoreValues = JSON.parse(storedRunScores);
            //    updateScoreCircles();
            //    updateHomeRunStats();
            //    updateRunHistory();
            //}
        });

        
        
        // TEMPORARY function to view all saved profiles
            function showProfiles() {
                const outputDiv = document.getElementById('profiles-output');
                outputDiv.innerHTML = ''; // Clear previous output
                // Loop through localStorage keys
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    // Check for keys that start with "profile_"
                    if (key.indexOf('profile_') === 0) {
                        const profile = JSON.parse(localStorage.getItem(key));
                        outputDiv.innerHTML += `<p><strong>${key}</strong>: ${JSON.stringify(profile)}</p>`;
                    }
                }
            }

        // Temporary function to clear all stored profiles
        function clearProfiles() {
            // Loop backwards through localStorage keys to safely remove items
            for (let i = localStorage.length - 1; i >= 0; i--) {
                const key = localStorage.key(i);
                if (key.indexOf('profile_') === 0) {
                    localStorage.removeItem(key);
                }
            }
            // Update the output to reflect the cleared profiles
            document.getElementById('profiles-output').innerHTML = 'All profiles have been cleared.';
        }

        // FAQs Page ------------------------------------------------------------------------- 
        document.addEventListener('DOMContentLoaded', function() {
            // Attach click event to each FAQ box so each toggles only its own answer
            document.querySelectorAll('.faq-box').forEach(function(box) {
                box.addEventListener('click', function(event) {
                event.stopPropagation();
                var answer = this.querySelector('.faq-answer');
                // Toggle display for this box's answer
                answer.style.display = (answer.style.display === "block") ? "none" : "block";
                });
            });
        });
    </script>
</body>
</html>